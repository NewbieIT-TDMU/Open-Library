<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Open Library - Th∆∞ vi·ªán s√°ch ƒëi·ªán t·ª≠</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --color-navy: #1a2a44;
        --color-primary: #007bff;
        --color-success: #28a745;
        --color-warning: #ffc107;
        --color-background: #f4f7f9;
      }

      body {
        background: var(--color-background);
        font-family: "Inter", sans-serif;
        min-height: 100vh;
        overflow-x: hidden;
        padding-top: 105px;
        color: #343a40;
        line-height: 1.6;
      }
      p,
      li {
        line-height: 1.6;
        font-size: 0.9rem;
      }
      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        font-weight: 700;
        color: #212529;
      }
      a {
        color: var(--color-primary);
        text-decoration: none;
        transition: color 0.3s ease;
      }
      a:hover {
        color: #0056b3;
      }

      .btn {
        font-weight: 600;
        border-radius: 6px;
        transition: all 0.3s ease;
      }
      .btn-primary {
        background-color: var(--color-primary);
        border-color: var(--color-primary);
      }
      .btn-primary:hover {
        background: #0056b3;
        border-color: #0056b3;
        transform: translateY(-1px);
      }
      .btn-warning {
        background-color: var(--color-warning);
        border-color: var(--color-warning);
        color: #212529;
      }
      .btn-warning:hover {
        background-color: #e0a800;
        border-color: #e0a800;
        transform: translateY(-1px);
      }
      .btn-success {
        background: var(--color-success);
        border-color: var(--color-success);
      }
      .btn-success:hover {
        background: #1e7e34;
        border-color: #1e7e34;
        transform: translateY(-1px);
      }
      .btn-borrowed {
        background-color: #6c757d;
        color: white;
        border: 1px solid #6c757d;
        cursor: not-allowed;
        opacity: 0.8;
      }

      .book-rating {
        color: var(--color-warning);
        font-size: 1rem;
        font-weight: 600;
      }

      .book-status {
        font-size: 0.75rem;
        font-weight: 600;
        padding: 3px 10px;
        border-radius: 50px;
        display: inline-block;
        margin-bottom: 5px;
        letter-spacing: 0.5px;
      }
      .status-available {
        background-color: #d4edda;
        color: #155724;
      }
      .status-borrowed {
        background-color: #fff3cd;
        color: #856404;
      }
      .status-guest {
        background-color: #e9ecef;
        color: #6c757d;
      }

      .navbar {
        background-color: var(--color-navy);
        border-bottom: 3px solid var(--color-primary);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }
      .navbar .navbar-brand {
        font-size: 1.7rem;
        font-weight: 800;
      }
      .navbar .nav-link {
        color: rgba(255, 255, 255, 0.8) !important;
        font-weight: 500;
        transition: all 0.3s ease;
      }
      .navbar .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.1);
        color: white !important;
      }
      .navbar .nav-link.active {
        background-color: var(--color-primary);
        color: white !important;
        font-weight: 600;
      }
      .profile-dropdown-toggle {
        background-color: rgba(255, 255, 255, 0.15);
        padding: 6px 15px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
        color: white;
        font-weight: 600;
        transition: background-color 0.3s;
      }
      .profile-dropdown-toggle:hover {
        background-color: rgba(255, 255, 255, 0.25);
      }
      .profile-dropdown-toggle .fa-user {
        color: var(--color-warning);
        background-color: rgba(255, 193, 7, 0.2);
        padding: 5px 8px;
        border-radius: 5px;
      }

      .search-container {
        max-width: 450px;
      }
      #searchInput {
        background-color: rgba(255, 255, 255, 0.95);
        border-radius: 8px;
        font-size: 0.9rem;
        padding-left: 35px;
      }

      #heroBanner {
        background: #e9f2f8;
        padding: 70px 0;
        margin-bottom: 40px;
        border-radius: 12px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
      }
      #heroBanner h1 {
        font-size: 3.2rem;
        font-weight: 800;
        color: var(--color-navy);
      }
      #heroBanner .lead {
        font-size: 1.15rem;
        color: #5a6268;
        margin-bottom: 30px;
      }

      .section-title {
        font-weight: 700;
        color: var(--color-navy);
        border-left: 5px solid var(--color-primary);
        padding-left: 15px;
        padding-top: 2px;
        padding-bottom: 2px;
        margin-bottom: 30px;
        display: block;
      }

      .card-book {
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        border: 1px solid #e9ecef;
        overflow: hidden;
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      }
      .card-book:hover {
        transform: translateY(-5px) scale(1.02);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
      }
      .book-cover-container {
        padding: 10px;
        background-color: #ffffff;
        height: 190px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
      }
      .book-cover {
        max-height: 100%;
        width: auto;
        object-fit: contain;
        border-radius: 5px;
      }
      .card-book .card-title {
        font-size: 1rem;
        font-weight: 600;
        min-height: 48px;
        position: relative;
        padding-right: 25px;
      }
      .card-book .favorite {
        position: absolute;
        right: 0;
        top: 5px;
        cursor: pointer;
        color: #dc3545;
        transition: transform 0.2s;
        font-size: 1.1rem;
      }
      .card-book .favorite:hover {
        transform: scale(1.2);
      }

      /* Featured Book */
      .featured-content {
        padding: 30px;
      }
      .featured-cover {
        border-radius: 8px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      #profilePage .card {
        border-radius: 12px;
      }
      .stat-card {
        text-align: center;
        padding: 20px;
        background: #ffffff;
        cursor: pointer;
        transition: all 0.3s;
      }
      .stat-card:hover {
        background: #f0f7ff;
        transform: translateY(-2px) scale(1.03);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.08);
      }
      .stat-card .stat-value {
        font-size: 2.5rem; 
        font-weight: 900;
        transition: color 0.3s;
      }
      .stat-card:hover .stat-value {
        color: var(--color-navy);
      }
      .stat-card .stat-label {
        font-weight: 500;
        color: #6c757d;
      }
      #profileTabs .nav-link {
        font-weight: 600;
      }
      #profileTabs .nav-link.active {
        color: var(--color-navy);
        border-bottom: 3px solid var(--color-primary);
        background-color: #f8f9fa;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
      }
      .book-list-item {
        border: 1px solid #dee2e6;
        background-color: #fff;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 10px;
        transition: all 0.2s;
      }
      .book-list-item:hover {
        background-color: #fcfcfc;
        border-color: #c0c0c0;
      }
      .text-book {
        font-style: italic;
        font-weight: 500;
        color: #007bff;
      }

      .history-list {
        list-style: none;
        padding: 0;
        position: relative;
        padding-left: 20px;
        border-left: 2px solid #e9ecef;
      }
      .history-item {
        position: relative;
        margin-bottom: 20px;
        padding-bottom: 15px;
        display: flex;
        gap: 10px;
        align-items: flex-start;
      }
      .history-item::before {
        content: "";
        position: absolute;
        left: -29px;
        top: 5px;
        width: 15px;
        height: 15px;
        border-radius: 50%;
        background-color: #1a2a44;
        border: 3px solid var(--color-background);
      }
      .history-item.success::before {
        background-color: var(--color-success);
      }
      .history-item.warning::before {
        background-color: var(--color-warning);
      }
      .history-item.info::before {
        background-color: var(--color-primary);
      }
      .history-item.error::before {
        background-color: #dc3545;
      }

      .history-icon {
        font-size: 1.1rem;
        color: #6c757d;
        margin-top: 5px;
      }
      .history-content {
        flex-grow: 1;
        font-size: 0.9rem;
      }
      .history-time {
        font-size: 0.75rem;
        color: #999;
        align-self: flex-start;
        white-space: nowrap;
      }

      .contribution-card {
        background: #ffffff;
        border-left: 5px solid var(--color-primary);
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      }
      .contribution-stats {
        background-color: #f0f7ff;
        border-radius: 8px;
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.03);
      }
      .contribution-stat-value {
        color: var(--color-navy);
        font-weight: 800;
        font-size: 1.8rem;
      }

      #bookModal .modal-dialog {
        max-width: 950px;
      }
      #modalActions .btn {
        padding: 10px;
        font-size: 1rem;
      }
      #pdfIframeContainer {
        border: 1px solid #dee2e6;
      }

      footer {
        background-color: #213554;
        color: #ffffff;
        padding: 30px 0 15px;
        margin-top: 50px;
      }
      footer h5 {
        color: white;
        font-weight: 700;
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        padding-bottom: 10px;
        margin-bottom: 15px;
      }
      footer a {
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.9rem;
      }
      footer a:hover {
        color: white;
      }

      @media (max-width: 991.98px) {
        body {
          padding-top: 130px;
        }
        .navbar {
          padding-bottom: 0;
        }
        .navbar-top {
          flex-wrap: wrap;
        }
        .search-container {
          margin: 10px 0;
          max-width: 100%;
          order: 3;
        }
        .navbar-bottom {
          padding-top: 0;
        }
        .book-cover-container {
          height: 160px;
        }
        .card-book .card-title {
          min-height: 40px;
          font-size: 0.9rem;
        }
      }
      @media (max-width: 575.98px) {
        .card-book .card-title {
          min-height: 48px;
          font-size: 1rem;
        }
        .book-cover-container {
          height: 200px;
        }
        #heroBanner h1 {
          font-size: 2.2rem;
        }
      }
    </style>
  </head>
  <body>
    <div
      id="preloader"
      style="
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: #ffffff;
        z-index: 99999;
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 1;
        transition: opacity 0.5s;
      "
    >
      <div
        class="spinner"
        style="
          width: 50px;
          height: 50px;
          border: 5px solid #f3f3f3;
          border-top: 5px solid var(--color-navy);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        "
      ></div>
    </div>
    <style>
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>

    <nav class="navbar navbar-expand-lg fixed-top">
      <div class="header-container container-fluid">
        <div
          class="navbar-top d-flex align-items-center justify-content-between w-100 py-2"
        >
          <a
            class="navbar-brand fw-bold"
            style="color: white !important"
            href="#"
            id="homeLink"
            ><i class="fas fa-book-open me-2"></i> Open Library</a
          >

          <div id="authActions" class="d-flex align-items-center">
            <button
              class="btn btn-sm btn-warning text-dark me-2 fw-bold"
              id="btnLoginRegister"
              style="display: none"
              onclick="promptLogin()"
            >
              <i class="fas fa-sign-in-alt me-1"></i> ƒêƒÉng nh·∫≠p
            </button>

            <div class="dropdown" id="profileDropdown" style="display: none">
              <a
                class="profile-dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <i class="fas fa-user"></i>
                <span id="navUserName">T√†i kho·∫£n</span>
              </a>
              <ul
                class="dropdown-menu dropdown-menu-end shadow-lg border-0 mt-2"
              >
                <li>
                  <h6 class="dropdown-header">
                    Xin ch√†o, <span id="dropdownUserName"></span>
                  </h6>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a
                    class="dropdown-item"
                    href="#"
                    onclick="handleNavClick('profile')"
                    ><i class="fas fa-user-circle me-2 text-primary"></i> Trang
                    c√° nh√¢n</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    href="#"
                    onclick="handleNavClick('favorites', true)"
                    ><i class="fas fa-heart me-2 text-danger"></i> S√°ch y√™u
                    th√≠ch</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    href="#"
                    onclick="handleNavClick('borrowed', true)"
                    ><i class="fas fa-exchange-alt me-2 text-warning"></i> S√°ch
                    ƒëang m∆∞·ª£n</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item text-danger" href="#" id="btnLogout"
                    ><i class="fas fa-sign-out-alt me-2"></i> ƒêƒÉng xu·∫•t</a
                  >
                </li>
              </ul>
            </div>
          </div>

          <button
            class="navbar-toggler text-white border-white"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarContent"
          >
            <span class="fas fa-bars"></span>
          </button>
        </div>

        <div
          class="navbar-bottom w-100 bg-opacity-75"
          style="background-color: #213554"
        >
          <div
            class="collapse navbar-collapse justify-content-between"
            id="navbarContent"
          >
            <ul class="navbar-nav mb-2 mb-lg-0">
              <li class="nav-item">
                <a
                  class="nav-link active"
                  id="navHomeLink"
                  href="#"
                  onclick="handleNavClick('home')"
                  ><i class="fas fa-home me-1"></i> Trang Ch·ªß</a
                >
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  id="navCatalogLink"
                  href="#"
                  onclick="handleNavClick('catalog')"
                  ><i class="fas fa-book me-1"></i> Danh M·ª•c S√°ch</a
                >
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  id="navContributeLink"
                  href="#"
                  onclick="handleNavClick('contributionPage')"
                  ><i class="fas fa-hands-helping me-1"></i> ƒê√≥ng G√≥p</a
                >
              </li>
            </ul>
            <form
              class="d-flex search-container position-relative py-2 py-lg-0 me-lg-4"
              role="search"
              onsubmit="return false"
            >
              <input
                id="searchInput"
                class="form-control me-2 ps-4"
                type="search"
                placeholder="T√¨m ki·∫øm nhanh..."
              />
              <i
                class="fas fa-search position-absolute"
                style="
                  left: 12px;
                  top: 50%;
                  transform: translateY(-50%);
                  color: #aaa;
                "
              ></i>
            </form>
          </div>
        </div>
      </div>
    </nav>

    <div class="container py-4">
      <div id="heroBanner" class="animate__animated animate__fadeIn">
        <div class="container-sm text-center">
          <h1>Lan T·ªèa Tri Th·ª©c üí° C·ªông ƒê·ªìng</h1>
          <p class="lead">
            H√†ng ng√†n ƒë·∫ßu s√°ch ƒëi·ªán t·ª≠ mi·ªÖn ph√≠ ƒëang ch·ªù b·∫°n kh√°m ph√°. ƒêƒÉng nh·∫≠p
            ƒë·ªÉ m∆∞·ª£n v√† ƒë·ªçc ngay!
          </p>
          <button
            class="btn btn-lg btn-primary"
            onclick="document.getElementById('catalogTitle').scrollIntoView({ behavior: 'smooth' });"
          >
            <i class="fas fa-eye me-1"></i> Kh√°m ph√° Danh M·ª•c
          </button>
        </div>
      </div>

      <div class="content-wrapper">
        <section id="hotBooksSection" class="mb-5" style="display: none">
          <h3 class="section-title">
            <i class="fas fa-fire me-2"></i> S√°ch ƒêang Xu H∆∞·ªõng Tu·∫ßn N√†y
          </h3>
          <div id="hotBooksContainer" class="row"></div>
        </section>

        <section id="featuredBookSection" class="mb-5" style="display: none">
          <h3 class="section-title">
            <i class="fas fa-star me-2"></i> S√°ch ƒê·ªÅ Xu·∫•t H√¥m Nay
          </h3>
          <div class="card shadow-sm border-0">
            <div id="featuredBookContent" class="row g-0"></div>
          </div>
        </section>

        <div
          id="profilePage"
          style="display: none"
          class="animate__animated animate__fadeIn"
        >
          <h3 class="section-title mb-4">
            <i class="fas fa-user-circle me-2"></i> Trang C√° Nh√¢n C·ªßa B·∫°n
          </h3>

          <div class="row mb-4 g-3">
            <div class="col-md-4">
              <div
                class="card stat-card border-danger-subtle shadow-sm"
                onclick="handleNavClick('favorites', true)"
              >
                <i class="fas fa-heart fa-2x text-danger mb-2"></i>
                <div class="stat-value text-danger" id="favoritesCount">0</div>
                <div class="stat-label">S√°ch Y√™u Th√≠ch</div>
              </div>
            </div>

            <div class="col-md-4">
              <div
                class="card stat-card border-warning-subtle shadow-sm"
                onclick="handleNavClick('borrowed', true)"
              >
                <i class="fas fa-exchange-alt fa-2x text-warning mb-2"></i>
                <div class="stat-value text-warning" id="borrowedCount">0</div>
                <div class="stat-label">S√°ch ƒêang M∆∞·ª£n</div>
              </div>
            </div>

            <div class="col-md-4">
              <div
                class="card stat-card border-info-subtle shadow-sm"
                onclick="handleNavClick('contributionPage')"
              >
                <i class="fas fa-hands-helping fa-2x text-info mb-2"></i>
                <div class="stat-value text-info" id="viewCount">0</div>
                <div class="stat-label">ƒê√≥ng G√≥p ƒê√£ G·ª≠i</div>
              </div>
            </div>
          </div>

          <div class="card p-4 shadow-lg border-0">
            <div class="row">
              <div class="col-md-3 border-end">
                <div class="card p-3 mb-4 text-center border-0">
                  <i class="fas fa-user-tie fa-6x text-primary mb-3"></i>
                  <h5 class="fw-bold text-primary" id="profileUserName"></h5>
                  <p
                    class="text-muted mb-1"
                    id="profileUserEmail"
                    style="font-size: 0.9rem"
                  ></p>
                  <hr />
                  <p class="mb-2" style="font-size: 0.8rem">
                    <i class="fas fa-calendar-alt me-1 text-success"></i> Tham
                    gia t·ª´:
                    <span
                      class="fw-bold text-success"
                      id="accountCreatedDate"
                    ></span>
                  </p>
                  <button
                    class="btn btn-sm btn-outline-secondary mt-2 w-100"
                    data-bs-toggle="modal"
                    data-bs-target="#changePasswordModal"
                  >
                    <i class="fas fa-key me-1"></i> ƒê·ªïi M·∫≠t Kh·∫©u
                  </button>
                </div>
              </div>

              <div class="col-md-9">
                <ul class="nav nav-tabs" id="profileTabs" role="tablist">
                  <li class="nav-item" role="presentation">
                    <button
                      class="nav-link active"
                      id="info-tab"
                      data-bs-toggle="tab"
                      data-bs-target="#info"
                      type="button"
                      role="tab"
                    >
                      <i class="fas fa-info-circle me-1"></i> T·ªïng quan
                    </button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button
                      class="nav-link"
                      id="borrowed-tab"
                      data-bs-toggle="tab"
                      data-bs-target="#borrowed"
                      type="button"
                      role="tab"
                    >
                      <i class="fas fa-list-alt me-1"></i> ƒêang M∆∞·ª£n
                    </button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button
                      class="nav-link"
                      id="favorites-tab"
                      data-bs-toggle="tab"
                      data-bs-target="#favorites"
                      type="button"
                      role="tab"
                    >
                      <i class="fas fa-heart me-1"></i> Y√™u th√≠ch
                    </button>
                  </li>
                </ul>
                <div class="tab-content pt-3">
                  <div
                    class="tab-pane fade show active"
                    id="info"
                    role="tabpanel"
                  >
                    <h6>
                      <i class="fas fa-history me-2"></i> L·ªãch S·ª≠ Ho·∫°t ƒê·ªông G·∫ßn
                      ƒê√¢y
                    </h6>
                    <p class="text-muted" style="font-size: 0.85rem">
                      C√°c ho·∫°t ƒë·ªông quan tr·ªçng c·ªßa b·∫°n ƒë∆∞·ª£c ghi l·∫°i d∆∞·ªõi ƒë√¢y
                      (gi·ªõi h·∫°n 10 ho·∫°t ƒë·ªông g·∫ßn nh·∫•t).
                    </p>
                    <ul id="activityHistoryList" class="history-list"></ul>
                  </div>
                  <div class="tab-pane fade" id="borrowed" role="tabpanel">
                    <h6>C√°c s√°ch b·∫°n ƒëang m∆∞·ª£n</h6>
                    <div id="borrowedBooksList" class="row pt-3 g-2"></div>
                  </div>
                  <div class="tab-pane fade" id="favorites" role="tabpanel">
                    <h6>C√°c s√°ch b·∫°n y√™u th√≠ch</h6>
                    <div id="favoriteBooksList" class="row pt-3 g-2"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div
          id="contributionPage"
          style="display: none"
          class="animate__animated animate__fadeIn"
        >
          <h3 class="section-title mb-4">
            <i class="fas fa-hands-helping me-2"></i> ƒê√≥ng G√≥p V·ªõi Open Library
          </h3>

          <div class="row g-4">
            <div class="col-lg-8">
              <div class="contribution-card">
                <h4 class="text-primary mb-3">S·ª© m·ªánh: Lan t·ªèa tri th·ª©c</h4>
                <p class="lead text-muted" style="font-size: 1rem">
                  M·ªói ƒë√≥ng g√≥p c·ªßa b·∫°n ƒë·ªÅu l√†m cho th∆∞ vi·ªán c·ªßa ch√∫ng ta phong
                  ph√∫ h∆°n v√† gi√∫p c·ªông ƒë·ªìng ph√°t tri·ªÉn.
                </p>

                <div class="contribution-stats row mb-4 p-3 g-2">
                  <div class="col-md-6 text-center py-2 border-end">
                    <div
                      class="contribution-stat-value"
                      id="totalContributions"
                    >
                      53
                    </div>
                    <div class="text-muted">T·ªïng s·ªë ƒë√≥ng g√≥p ƒë√£ duy·ªát</div>
                  </div>
                  <div class="col-md-6 text-center py-2">
                    <div class="contribution-stat-value" id="contributorCount">
                      12
                    </div>
                    <div class="text-muted">S·ªë ng∆∞·ªùi ƒë√≥ng g√≥p t√≠ch c·ª±c</div>
                  </div>
                </div>

                <h5 class="mb-3 fw-bold">
                  <i class="fas fa-paper-plane me-2 text-primary"></i> Ch√∫ng t√¥i
                  hoan ngh√™nh:
                </h5>
                <ul class="list-unstyled">
                  <li>
                    <i class="fas fa-check-circle text-success me-2"></i> **S√°ch
                    ƒëi·ªán t·ª≠ (Ebook/PDF)**
                  </li>
                  <li>
                    <i class="fas fa-check-circle text-success me-2"></i> **T√†i
                    li·ªáu h·ªçc thu·∫≠t/Nghi√™n c·ª©u**
                  </li>
                  <li>
                    <i class="fas fa-check-circle text-success me-2"></i>
                    **ƒê∆∞·ªùng link/Ngu·ªìn s√°ch uy t√≠n**
                  </li>
                </ul>

                <div class="d-grid mt-4">
                  <button
                    class="btn btn-lg btn-success"
                    data-bs-toggle="modal"
                    data-bs-target="#contributionModal"
                    onclick="fillContributionForm()"
                  >
                    <i class="fas fa-plus me-2"></i> G·ª≠i ƒê√≥ng G√≥p C·ªßa B·∫°n
                  </button>
                </div>
              </div>
            </div>

            <div class="col-lg-4">
              <div class="card p-4 shadow-sm h-100 border-0">
                <h5 class="card-title text-info border-bottom pb-2 mb-3">
                  <i class="fas fa-list-alt me-2"></i> L·ªãch S·ª≠ ƒê√≥ng G√≥p C·ªßa T√¥i
                </h5>
                <div id="myContributionsContainer">
                  <p class="text-muted" style="font-size: 0.9rem">
                    Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ theo d√µi l·ªãch s·ª≠ v√† tr·∫°ng th√°i c√°c
                    ƒë√≥ng g√≥p ƒë√£ g·ª≠i.
                  </p>
                  <button
                    class="btn btn-sm btn-outline-primary w-100"
                    onclick="promptLogin()"
                  >
                    <i class="fas fa-sign-in-alt me-1"></i> ƒêƒÉng nh·∫≠p
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="row mt-5">
            <div class="col-12">
              <h4 class="section-title">
                <i class="fas fa-thumbs-up me-2"></i> Nh·ªØng ƒê√≥ng G√≥p Ti√™u Bi·ªÉu
              </h4>
              <div class="row g-3" id="topContributionsList">
                <div class="col-md-4">
                  <div class="card p-3 h-100 border-success-subtle shadow-sm">
                    <p
                      class="mb-1 fw-bold text-success"
                      style="font-size: 0.9rem"
                    >
                      <i class="fas fa-check-circle me-1"></i> S√°ch: L·ªãch s·ª≠
                      Tr√°i ƒê·∫•t
                    </p>
                    <p class="mb-1 text-muted" style="font-size: 0.85rem">
                      Ng∆∞·ªùi g·ª≠i: Anonymous
                    </p>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card p-3 h-100 border-success-subtle shadow-sm">
                    <p
                      class="mb-1 fw-bold text-success"
                      style="font-size: 0.95rem"
                    >
                      <i class="fas fa-check-circle me-1"></i> T√†i li·ªáu: B√°o c√°o
                      Khoa h·ªçc XYZ
                    </p>
                    <p class="mb-1 text-muted" style="font-size: 0.85rem">
                      Ng∆∞·ªùi g·ª≠i: Nguy·ªÖn B
                    </p>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card p-3 h-100 border-success-subtle shadow-sm">
                    <p
                      class="mb-1 fw-bold text-success"
                      style="font-size: 0.95rem"
                    >
                      <i class="fas fa-check-circle me-1"></i> Link: Kho s√°ch K·ªπ
                      nƒÉng m·ªÅm
                    </p>
                    <p class="mb-1 text-muted" style="font-size: 0.85rem">
                      Ng∆∞·ªùi g·ª≠i: ƒê·ªôc gi·∫£ A
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div id="catalogArea" class="row g-4 animate__animated animate__fadeIn">
          <div class="col-lg-3">
            <div
              id="authPanel"
              class="card shadow-sm mb-4 animate__animated animate__fadeInLeft"
              style="display: none"
            >
              <div class="card-body">
                <h6 id="authTitle" class="text-primary mb-3">
                  <i class="fas fa-sign-in-alt"></i> ƒêƒÉng nh·∫≠p
                </h6>
                <form id="authForm">
                  <div class="mb-3" id="authNameDiv" style="display: none">
                    <label class="form-label fw-bold" style="font-size: 0.9rem"
                      >T√™n c·ªßa b·∫°n</label
                    >
                    <input
                      type="text"
                      class="form-control form-control-sm"
                      id="authName"
                    />
                  </div>
                  <div class="mb-3">
                    <label class="form-label fw-bold" style="font-size: 0.9rem"
                      >Email ƒëƒÉng nh·∫≠p</label
                    >
                    <input
                      type="email"
                      class="form-control form-control-sm"
                      id="authEmail"
                      required
                    />
                  </div>
                  <div class="mb-3">
                    <label class="form-label fw-bold" style="font-size: 0.9rem"
                      >M·∫≠t kh·∫©u</label
                    >
                    <input
                      type="password"
                      class="form-control form-control-sm"
                      id="authPassword"
                      required
                    />
                  </div>
                  <button
                    type="submit"
                    class="btn btn-primary btn-sm w-100"
                    id="authBtn"
                  >
                    ƒêƒÉng nh·∫≠p
                  </button>
                </form>
                <p class="mt-3 text-center mb-0">
                  <span
                    id="toggleAuth"
                    style="
                      cursor: pointer;
                      color: #007bff;
                      font-weight: 600;
                      font-size: 0.9rem;
                    "
                    >Ch∆∞a c√≥ t√†i kho·∫£n? ƒêƒÉng k√Ω ngay!</span
                  >
                </p>
              </div>
            </div>

            <div
              class="card shadow-sm animate__animated animate__fadeInLeft mb-4"
              id="filterPanel"
            >
              <div class="card-body">
                <h6 class="card-title text-primary mb-3">
                  <i class="fas fa-filter me-2"></i> L·ªçc & S·∫Øp x·∫øp
                </h6>
                <label class="form-label mb-1 fw-bold" style="font-size: 0.9rem"
                  >Th·ªÉ lo·∫°i:</label
                >
                <select
                  id="categoryFilter"
                  class="form-select mb-3 form-select-sm"
                >
                  <option value="All">T·∫•t c·∫£</option>
                </select>
                <label class="form-label mb-1 fw-bold" style="font-size: 0.9rem"
                  >NƒÉm xu·∫•t b·∫£n:</label
                >
                <select id="yearFilter" class="form-select mb-3 form-select-sm">
                  <option value="All">T·∫•t c·∫£ c√°c nƒÉm</option>
                </select>
                <label class="form-label mb-1 fw-bold" style="font-size: 0.9rem"
                  >S·ªë trang:</label
                >
                <select id="pageFilter" class="form-select mb-3 form-select-sm">
                  <option value="All">T·∫•t c·∫£</option>
                  <option value="<200">D∆∞·ªõi 200 trang</option>
                  <option value="200-500">200 - 500 trang</option>
                  <option value=">500">Tr√™n 500 trang</option>
                </select>
                <label class="form-label mb-1 fw-bold" style="font-size: 0.9rem"
                  >S·∫Øp x·∫øp:</label
                >
                <select id="sortOption" class="form-select form-select-sm">
                  <option value="titleAsc">T√™n (A-Z)</option>
                  <option value="titleDesc">T√™n (Z-A)</option>
                  <option value="ratingDesc">ƒê√°nh gi√° cao nh·∫•t</option>
                  <option value="publishedYearDesc">M·ªõi nh·∫•t</option>
                </select>
              </div>
            </div>

            <div
              class="card shadow-sm d-none d-lg-block animate__animated animate__fadeInLeft"
              style="--animate-delay: 0.2s"
            >
              <div class="card-body">
                <h6 class="card-title text-primary">
                  <i class="fas fa-info-circle"></i> V·ªÅ Th∆∞ vi·ªán
                </h6>
                <p style="font-size: 0.85rem">
                  Open Library l√† d·ª± √°n phi l·ª£i nhu·∫≠n, cung c·∫•p ngu·ªìn s√°ch mi·ªÖn
                  ph√≠ cho c·ªông ƒë·ªìng.
                </p>
                <button
                  class="btn btn-sm btn-outline-secondary w-100"
                  id="btnContribute"
                >
                  <i class="fas fa-hands-helping me-1"></i> ƒê√≥ng g√≥p
                </button>
              </div>
            </div>
          </div>

          <div class="col-lg-9">
            <h4
              id="catalogTitle"
              class="mb-4 fw-bold animate__animated animate__fadeIn"
            >
              üìö T·∫•t C·∫£ S√°ch Hi·ªán C√≥
            </h4>
            <div id="viewContainer" class="row g-4"></div>

            <nav
              aria-label="Book Pagination"
              class="mt-4 animate__animated animate__fadeInUp"
              style="--animate-delay: 0.5s"
            >
              <ul
                class="pagination justify-content-center"
                id="pagination"
              ></ul>
            </nav>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="bookModal" tabindex="-1">
      <div class="modal-dialog modal-xl">
        <div class="modal-content border-0 shadow-lg">
          <div class="modal-header bg-light">
            <h5 class="modal-title text-primary" id="bookModalTitle">
              <i class="fas fa-info-circle me-2"></i> Chi ti·∫øt s√°ch
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body p-4">
            <div class="row">
              <div class="col-md-4 text-center border-end">
                <img
                  id="modalCover"
                  class="img-fluid mb-3"
                  style="
                    max-height: 350px;
                    border-radius: 8px;
                    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
                  "
                  alt="B√¨a s√°ch"
                />
                <h4 id="modalTitle" class="fw-bold text-primary mt-3"></h4>
                <p
                  class="text-muted mb-2"
                  id="modalAuthor"
                  style="font-size: 1rem"
                ></p>
                <p id="modalRating" class="mb-3"></p>

                <div id="modalActions" class="d-grid gap-2 mb-3 px-3"></div>
                <div class="text-start px-3">
                  <p style="font-size: 0.9rem">
                    <b>Th·ªÉ lo·∫°i:</b> <span id="modalCategory"></span>
                  </p>
                  <p style="font-size: 0.9rem">
                    <b>ISBN:</b> <span id="modalISBN"></span>
                  </p>
                  <p style="font-size: 0.9rem">
                    <b>NƒÉm XB:</b> <span id="modalPublishedYear"></span>
                  </p>
                  <p style="font-size: 0.9rem">
                    <b>S·ªë trang:</b> <span id="modalPages"></span>
                  </p>
                </div>
              </div>

              <div class="col-md-8">
                <ul class="nav nav-tabs" id="bookTabs" role="tablist">
                  <li class="nav-item" role="presentation">
                    <button
                      class="nav-link active"
                      id="desc-tab"
                      data-bs-toggle="tab"
                      data-bs-target="#desc"
                      type="button"
                      role="tab"
                    >
                      <i class="fas fa-file-alt me-1"></i> M√¥ T·∫£ Chi Ti·∫øt
                    </button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button
                      class="nav-link"
                      id="preview-tab"
                      data-bs-toggle="tab"
                      data-bs-target="#preview"
                      type="button"
                      role="tab"
                    >
                      <i class="fas fa-eye me-1"></i> Xem Tr∆∞·ªõc
                    </button>
                  </li>
                </ul>
                <div class="tab-content pt-3">
                  <div
                    class="tab-pane fade show active"
                    id="desc"
                    role="tabpanel"
                  >
                    <p id="modalDescription" class="text-justify"></p>
                  </div>
                  <div class="tab-pane fade" id="preview" role="tabpanel">
                    <div
                      id="pdfIframeContainer"
                      style="
                        height: 500px;
                        border: 1px solid #ccc;
                        border-radius: 8px;
                        overflow: hidden;
                      "
                    >
                      <iframe
                        id="pdfIframe"
                        src=""
                        width="100%"
                        height="100%"
                        frameborder="0"
                      ></iframe>
                    </div>
                    <p class="mt-2 text-muted" style="font-size: 0.8rem">
                      <i class="fas fa-info-circle me-1"></i> Ch·ª©c nƒÉng xem
                      tr∆∞·ªõc c√≥ th·ªÉ kh√¥ng ho·∫°t ƒë·ªông tr√™n m·ªôt s·ªë tr√¨nh duy·ªát.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="contributionModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title text-success">
              <i class="fas fa-hand-holding-heart me-2"></i> Phi·∫øu ƒê√≥ng G√≥p
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <p class="text-muted">
              C·∫£m ∆°n b·∫°n ƒë√£ mu·ªën ƒë√≥ng g√≥p! Vui l√≤ng ƒëi·ªÅn th√¥ng tin s√°ch/t√†i li·ªáu
              b·∫°n mu·ªën chia s·∫ª.
            </p>
            <form id="contributionForm">
              <div class="mb-3">
                <label class="form-label fw-bold"
                  >T√™n b·∫°n (kh√¥ng b·∫Øt bu·ªôc)</label
                >
                <input type="text" class="form-control" id="contributorName" />
              </div>
              <div class="mb-3">
                <label class="form-label fw-bold"
                  >Email li√™n h·ªá <span class="text-danger">*</span></label
                >
                <input
                  type="email"
                  class="form-control"
                  id="contributorEmail"
                  required
                />
                <div id="emailHelp" class="form-text">
                  ƒê√¢y l√† email ch√∫ng t√¥i s·∫Ω li√™n h·ªá l·∫°i v·ªõi b·∫°n.
                </div>
              </div>
              <hr />
              <div class="mb-3">
                <label class="form-label fw-bold"
                  >Ti√™u ƒë·ªÅ s√°ch/t√†i li·ªáu ƒë√≥ng g√≥p
                  <span class="text-danger">*</span></label
                >
                <input
                  type="text"
                  class="form-control"
                  id="contributedTitle"
                  required
                />
              </div>
              <div class="mb-3">
                <label class="form-label fw-bold"
                  >M√¥ t·∫£ ng·∫Øn/ƒê∆∞·ªùng link t√†i li·ªáu (PDF, Google Drive...)
                  <span class="text-danger">*</span></label
                >
                <textarea
                  class="form-control"
                  id="contributedLink"
                  rows="3"
                  required
                ></textarea>
                <div class="form-text">
                  Vui l√≤ng cung c·∫•p link t·∫£i/ƒë·ªçc ho·∫∑c link gi·ªõi thi·ªáu chi ti·∫øt.
                </div>
              </div>
              <button type="submit" class="btn btn-success w-100 mt-3">
                <i class="fas fa-paper-plane"></i> G·ª≠i ƒê√≥ng G√≥p
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="changePasswordModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-light">
            <h5 class="modal-title text-warning">
              <i class="fas fa-key me-2"></i> ƒê·ªïi M·∫≠t Kh·∫©u
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="changePasswordForm">
              <div class="mb-3">
                <label class="form-label fw-bold">M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
                <input
                  type="password"
                  class="form-control"
                  id="currentPassword"
                  required
                />
              </div>
              <div class="mb-3">
                <label class="form-label fw-bold">M·∫≠t kh·∫©u m·ªõi</label>
                <input
                  type="password"
                  class="form-control"
                  id="newPassword"
                  required
                />
                <div class="form-text">M·∫≠t kh·∫©u ph·∫£i d√†i √≠t nh·∫•t 6 k√Ω t·ª±.</div>
              </div>
              <div class="mb-3">
                <label class="form-label fw-bold">X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
                <input
                  type="password"
                  class="form-control"
                  id="confirmNewPassword"
                  required
                />
              </div>
              <button type="submit" class="btn btn-success w-100 mt-3">
                <i class="fas fa-save"></i> C·∫≠p Nh·∫≠t M·∫≠t Kh·∫©u
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <h5 class="fw-bold">
              <i class="fas fa-book-open"></i> Open Library
            </h5>
            <p style="font-size: 0.9rem">
              N·ªÅn t·∫£ng ƒë·ªçc s√°ch tr·ª±c tuy·∫øn mi·ªÖn ph√≠ v√† phi l·ª£i nhu·∫≠n.
            </p>
          </div>
          <div class="col-md-4">
            <h5>Li√™n k·∫øt nhanh</h5>
            <ul class="list-unstyled">
              <li>
                <a href="#" onclick="handleNavClick('home')">Trang Ch·ªß</a>
              </li>
              <li>
                <a href="#" onclick="handleNavClick('catalog')"
                  >Danh M·ª•c S√°ch</a
                >
              </li>
              <li>
                <a href="#" onclick="handleNavClick('contributionPage')"
                  >ƒê√≥ng G√≥p</a
                >
              </li>
            </ul>
          </div>
          <div class="col-md-4">
            <h5>Li√™n h·ªá</h5>
            <p style="font-size: 0.9rem">
              <i class="fas fa-envelope me-2"></i> contact@openlibrary.vn
            </p>
            <p style="font-size: 0.9rem">
              <i class="fas fa-map-marker-alt me-2"></i> TP. H·ªì Ch√≠ Minh, Vi·ªát
              Nam
            </p>
          </div>
        </div>
        <hr style="border-color: rgba(255, 255, 255, 0.1)" />
        <div class="text-center" style="font-size: 0.85rem">
          <p>&copy; 2025 Open Library. B·∫£o l∆∞u m·ªçi quy·ªÅn.</p>
        </div>
      </div>
    </footer>

    <div
      id="toastContainer"
      style="position: fixed; top: 100px; right: 20px; z-index: 2000"
    >
      <style>
        .toast-message {
          min-width: 250px;
          padding: 10px 15px;
          border-radius: 8px;
          color: white;
          font-size: 0.9rem;
          margin-bottom: 10px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
          opacity: 0;
          animation: fadeInOut 4s ease-in-out forwards;
        }
        .toast-success {
          background-color: var(--color-success);
        }
        .toast-error {
          background-color: #dc3545;
        }
        .toast-info {
          background-color: var(--color-primary);
        }

        @keyframes fadeInOut {
          0% {
            opacity: 0;
            transform: translateY(-20px);
          }
          10% {
            opacity: 1;
            transform: translateY(0);
          }
          90% {
            opacity: 1;
            transform: translateY(0);
          }
          100% {
            opacity: 0;
            transform: translateY(-20px);
          }
        }
      </style>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const books = [
        {
          title: "Nh·ªØng ng∆∞·ªùi kh·ªën kh·ªï",
          author: "Victor Hugo",
          isbn: "123456789",
          category: "VƒÉn h·ªçc",
          description:
            "Ti·ªÉu thuy·∫øt kinh ƒëi·ªÉn c·ªßa Victor Hugo. C√¢u chuy·ªán v·ªÅ c√¥ng l√Ω, s·ª± c·ª©u r·ªói v√† t√¨nh y√™u trong x√£ h·ªôi Ph√°p th·∫ø k·ª∑ 19.",
          cover: "https://covers.openlibrary.org/b/id/13247454-L.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/les-miserables.pdf",
          pages: 1463,
          publishedYear: 1862,
          rating: 4.5,
          hot: true,
        },
        {
          title: "D·∫ø M√®n phi√™u l∆∞u k√Ω",
          author: "T√¥ Ho√†i",
          isbn: "987654321",
          category: "Truy·ªán thi·∫øu nhi",
          description:
            "C√¢u chuy·ªán v·ªÅ ch√∫ d·∫ø M√®n d≈©ng c·∫£m. T√°c ph·∫©m kinh ƒëi·ªÉn d√†nh cho tr·∫ª em Vi·ªát Nam.",
          cover: "https://covers.openlibrary.org/b/id/8330756-L.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/the-adventures-of-huckleberry-finn.pdf",
          pages: 180,
          publishedYear: 1941,
          rating: 5.0,
          featured: true,
        }, 
        {
          title: "L·∫≠p tr√¨nh JavaScript N√¢ng cao",
          author: "Nguy·ªÖn VƒÉn A",
          isbn: "1122334455",
          category: "Khoa h·ªçc",
          description: "H·ªçc l·∫≠p tr√¨nh JS t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao.",
          cover:
            "https://images-na.ssl-images-amazon.com/images/S/compressed.photo.goodreads.com/books/1586518170i/51447094.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/dracula.pdf",
          pages: 600,
          publishedYear: 2022,
          rating: 4.0,
          hot: true,
        },
        {
          title: "Nh√† gi·∫£ kim",
          author: "Paulo Coelho",
          isbn: "444444444",
          category: "VƒÉn h·ªçc",
          description:
            "C√¢u chuy·ªán v·ªÅ h√†nh tr√¨nh t√¨m ki·∫øm kho b√°u c·ªßa ch√†ng chƒÉn c·ª´u Santiago.",
          cover: "https://covers.openlibrary.org/b/id/13251783-L.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/the-alchemist.pdf",
          pages: 208,
          publishedYear: 1988,
          rating: 4.8,
        },
        {
          title: "ƒê·∫Øc nh√¢n t√¢m",
          author: "Dale Carnegie",
          isbn: "555555555",
          category: "K·ªπ nƒÉng s·ªëng",
          description:
            "Ngh·ªá thu·∫≠t thu ph·ª•c l√≤ng ng∆∞·ªùi v√† g√¢y ·∫£nh h∆∞·ªüng ƒë·∫øn ng∆∞·ªùi kh√°c.",
          cover: "https://covers.openlibrary.org/b/id/13309257-L.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/pride-and-prejudice.pdf",
          pages: 300,
          publishedYear: 1936,
          rating: 4.2,
        },
        {
          title: "T√¢m l√Ω h·ªçc v·ªÅ ti·ªÅn",
          author: "Morgan Housel",
          isbn: "666666666",
          category: "Kinh t·∫ø",
          description:
            "19 c√¢u chuy·ªán v·ªÅ ti·ªÅn b·∫°c, s·ª± may m·∫Øn v√† h√†nh vi con ng∆∞·ªùi.",
          cover: "https://m.media-amazon.com/images/I/41-lUuR4oBL.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/the-money-psychology.pdf",
          pages: 256,
          publishedYear: 2020,
          rating: 4.7,
          hot: true,
        },
        {
          title: "Sapiens: L∆∞·ª£c s·ª≠ lo√†i ng∆∞·ªùi",
          author: "Yuval Noah Harari",
          isbn: "777777777",
          category: "L·ªãch s·ª≠",
          description:
            "C√°i nh√¨n to√†n c·∫£nh v·ªÅ l·ªãch s·ª≠ ph√°t tri·ªÉn c·ªßa lo√†i ng∆∞·ªùi.",
          cover: "https://m.media-amazon.com/images/I/51nJ7W0tYhL.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/sapiens.pdf",
          pages: 512,
          publishedYear: 2011,
          rating: 4.9,
        },
        {
          title: "Ti·ªÉu thuy·∫øt 1984",
          author: "George Orwell",
          isbn: "888888888",
          category: "VƒÉn h·ªçc",
          description:
            "M·ªôt trong nh·ªØng t√°c ph·∫©m ph·∫£n ƒë·ªãa ƒë√†ng vƒ© ƒë·∫°i nh·∫•t m·ªçi th·ªùi ƒë·∫°i.",
          cover: "https://covers.openlibrary.org/b/id/13336214-L.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/1984.pdf",
          pages: 328,
          publishedYear: 1949,
          rating: 4.6,
        },
        {
          title: "M·∫≠t m√£ Da Vinci",
          author: "Dan Brown",
          isbn: "999999999",
          category: "Ti·ªÉu thuy·∫øt",
          description: "Cu·ªën ti·ªÉu thuy·∫øt trinh th√°m n·ªïi ti·∫øng to√†n c·∫ßu.",
          cover: "https://covers.openlibrary.org/b/id/13289047-L.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/the-da-vinci-code.pdf",
          pages: 454,
          publishedYear: 2003,
          rating: 3.9,
        },
        {
          title: "V·∫≠t l√Ω l∆∞·ª£ng t·ª≠ c∆° b·∫£n",
          author: "Tr·∫ßn VƒÉn K",
          isbn: "101010101",
          category: "Khoa h·ªçc",
          description: "Gi·∫£i th√≠ch c√°c kh√°i ni·ªám c∆° b·∫£n v·ªÅ v·∫≠t l√Ω l∆∞·ª£ng t·ª≠.",
          cover: "https://m.media-amazon.com/images/I/41-jYp-0H8L.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/quantum-physics.pdf",
          pages: 550,
          publishedYear: 2018,
          rating: 4.1,
        },

        // --- S√ÅCH M·ªöI ƒê√É TH√äM L·∫¶N 2 ---
        {
          title: "B·∫£y th√≥i quen c·ªßa ng∆∞·ªùi th√†nh ƒë·∫°t",
          author: "Stephen Covey",
          isbn: "202020202",
          category: "K·ªπ nƒÉng s·ªëng",
          description:
            "Ph√°c th·∫£o m·ªôt c√°ch ti·∫øp c·∫≠n to√†n di·ªán, t√≠ch h·ª£p, nguy√™n t·∫Øc ƒë·ªÉ gi·∫£i quy·∫øt c√°c v·∫•n ƒë·ªÅ c√° nh√¢n v√† chuy√™n nghi·ªáp.",
          cover: "https://m.media-amazon.com/images/I/51f84s9H6WL.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/the-seven-habits.pdf",
          pages: 384,
          publishedYear: 1989,
          rating: 4.7,
        },
        {
          title: "Chi·∫øn Tranh v√† H√≤a B√¨nh",
          author: "Leo Tolstoy",
          isbn: "303030303",
          category: "VƒÉn h·ªçc",
          description:
            "Ti·ªÉu thuy·∫øt s·ª≠ thi v·ªÅ cu·ªôc chi·∫øn ch·ªëng Napoleon c·ªßa ng∆∞·ªùi Nga, kh√°m ph√° cu·ªôc s·ªëng v√† tri·∫øt l√Ω.",
          cover: "https://covers.openlibrary.org/b/id/13248359-L.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/war-and-peace.pdf",
          pages: 1225,
          publishedYear: 1869,
          rating: 4.6,
          hot: true,
        },
        {
          title: "Thao t√∫ng t√¢m l√Ω",
          author: "Harriet Lerner",
          isbn: "404040404",
          category: "T√¢m l√Ω h·ªçc",
          description:
            "C√°ch nh·∫≠n bi·∫øt v√† tho√°t kh·ªèi c√°c m·ªëi quan h·ªá ki·ªÉm so√°t.",
          cover: "https://m.media-amazon.com/images/I/51wQ3m0-Q0L.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/mind-manipulation.pdf",
          pages: 288,
          publishedYear: 2021,
          rating: 4.3,
        },
        {
          title: "Ngh·ªá thu·∫≠t t∆∞ duy r√†nh m·∫°ch",
          author: "Rolf Dobelli",
          isbn: "505050505",
          category: "K·ªπ nƒÉng s·ªëng",
          description: "Tr√°nh 52 l·ªói t∆∞ duy ph·ªï bi·∫øn ƒë·ªÉ c√≥ quy·∫øt ƒë·ªãnh t·ªët h∆°n.",
          cover: "https://m.media-amazon.com/images/I/513y17y8m5L.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/the-art-of-thinking.pdf",
          pages: 256,
          publishedYear: 2013,
          rating: 4.0,
        },
        {
          title: "C∆° s·ªü D·ªØ li·ªáu Quan h·ªá",
          author: "L√™ VƒÉn C",
          isbn: "606060606",
          category: "Khoa h·ªçc",
          description: "Gi·ªõi thi·ªáu v·ªÅ m√¥ h√¨nh d·ªØ li·ªáu quan h·ªá v√† SQL.",
          cover: "https://m.media-amazon.com/images/I/41Kx1e15g7L.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/database-design.pdf",
          pages: 400,
          publishedYear: 2019,
          rating: 4.4,
        },
        {
          title: "Truy·ªán Ki·ªÅu",
          author: "Nguy·ªÖn Du",
          isbn: "707070707",
          category: "VƒÉn h·ªçc",
          description: "Ki·ªát t√°c th∆° l·ª•c b√°t c·ªßa vƒÉn h·ªçc Vi·ªát Nam.",
          cover: "https://covers.openlibrary.org/b/id/6938997-L.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/the-tale-of-kieu.pdf",
          pages: 325,
          publishedYear: 1820,
          rating: 4.9,
        },
        {
          title: "C√† ph√™ c√πng Tony",
          author: "Tony Bu·ªïi S√°ng",
          isbn: "808080808",
          category: "K·ªπ nƒÉng s·ªëng",
          description:
            "C√°c b√†i h·ªçc v·ªÅ kinh doanh, kh·ªüi nghi·ªáp v√† th√°i ƒë·ªô s·ªëng.",
          cover: "https://m.media-amazon.com/images/I/51d6jU3d6PL.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/coffee-with-tony.pdf",
          pages: 250,
          publishedYear: 2014,
          rating: 4.1,
        },
        {
          title: "C·∫•u tr√∫c D·ªØ li·ªáu v√† Gi·∫£i thu·∫≠t",
          author: "Ph·∫°m Th·ªã D",
          isbn: "909090909",
          category: "Khoa h·ªçc",
          description:
            "T√†i li·ªáu n·ªÅn t·∫£ng cho sinh vi√™n ng√†nh C√¥ng ngh·ªá th√¥ng tin.",
          cover: "https://m.media-amazon.com/images/I/41t7+B9F65L.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/data-structures.pdf",
          pages: 650,
          publishedYear: 2023,
          rating: 4.5,
        },
        {
          title: "B√≠ m·∫≠t c·ªßa May M·∫Øn",
          author: "Alex Rovira & Fernando Tr√≠as de Bes",
          isbn: "131313131",
          category: "K·ªπ nƒÉng s·ªëng",
          description:
            "C√¢u chuy·ªán ng·ª• ng√¥n v·ªÅ c√°ch t·∫°o ra may m·∫Øn cho ch√≠nh m√¨nh.",
          cover: "https://m.media-amazon.com/images/I/41-3Fm7sYjL.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/the-secret-of-luck.pdf",
          pages: 128,
          publishedYear: 2004,
          rating: 4.2,
        },
        {
          title: "C∆° h·ªçc L∆∞·ª£ng t·ª≠",
          author: "David J. Griffiths",
          isbn: "141414141",
          category: "Khoa h·ªçc",
          description: "S√°ch gi√°o tr√¨nh chuy√™n s√¢u v·ªÅ c∆° h·ªçc l∆∞·ª£ng t·ª≠.",
          cover: "https://m.media-amazon.com/images/I/418sJ4E-VLL.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/quantum-mechanics-introduction.pdf",
          pages: 700,
          publishedYear: 1999,
          rating: 4.7,
        },
        {
          title: "√îng gi√† v√† bi·ªÉn c·∫£",
          author: "Ernest Hemingway",
          isbn: "151515151",
          category: "VƒÉn h·ªçc",
          description:
            "Ti·ªÉu thuy·∫øt ng·∫Øn n·ªïi ti·∫øng v·ªÅ cu·ªôc chi·∫øn sinh t·ªìn gi·ªØa ng∆∞·ªùi v√† thi√™n nhi√™n.",
          cover: "https://covers.openlibrary.org/b/id/13248386-L.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/the-old-man-and-the-sea.pdf",
          pages: 127,
          publishedYear: 1952,
          rating: 4.4,
        },
        {
          title: "100 nƒÉm c√¥ ƒë∆°n",
          author: "Gabriel Garc√≠a M√°rquez",
          isbn: "161616161",
          category: "VƒÉn h·ªçc",
          description:
            "Tuy·ªát t√°c vƒÉn h·ªçc M·ªπ Latinh, c√¢u chuy·ªán v·ªÅ gia t·ªôc Buend√≠a.",
          cover: "https://covers.openlibrary.org/b/id/13251781-L.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/one-hundred-years-of-solitude.pdf",
          pages: 417,
          publishedYear: 1967,
          rating: 4.8,
        },
        {
          title: "Thi·∫øt k·∫ø ƒë·ªì h·ªça c∆° b·∫£n",
          author: "Tr·∫ßn H·ªØu F",
          isbn: "171717171",
          category: "Ngh·ªá thu·∫≠t",
          description: "H∆∞·ªõng d·∫´n to√†n di·ªán v·ªÅ c√°c nguy√™n t·∫Øc thi·∫øt k·∫ø ƒë·ªì h·ªça.",
          cover: "https://m.media-amazon.com/images/I/51wXw0519aL.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/graphic-design-basics.pdf",
          pages: 350,
          publishedYear: 2021,
          rating: 4.3,
        },
        {
          title: "Ngh·ªá thu·∫≠t b√°n h√†ng b·∫≠c cao",
          author: "Zig Ziglar",
          isbn: "181818181",
          category: "K·ªπ nƒÉng s·ªëng",
          description:
            "C√°c k·ªπ thu·∫≠t v√† tri·∫øt l√Ω ƒë·ªÉ tr·ªü th√†nh ng∆∞·ªùi b√°n h√†ng xu·∫•t s·∫Øc.",
          cover: "https://m.media-amazon.com/images/I/51tW0iJ06bL.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/secrets-of-closing.pdf",
          pages: 304,
          publishedYear: 1984,
          rating: 4.0,
        },
        {
          title: "L√Ω thuy·∫øt tr√≤ ch∆°i",
          author: "Avinash Dixit & Barry Nalebuff",
          isbn: "191919191",
          category: "Kinh t·∫ø",
          description:
            "·ª®ng d·ª•ng l√Ω thuy·∫øt tr√≤ ch∆°i v√†o chi·∫øn l∆∞·ª£c kinh doanh v√† cu·ªôc s·ªëng.",
          cover: "https://m.media-amazon.com/images/I/51uT8vVlYWL.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/the-art-of-strategy.pdf",
          pages: 480,
          publishedYear: 1991,
          rating: 4.5,
        },
        {
          title: "T∆∞ duy nhanh v√† ch·∫≠m",
          author: "Daniel Kahneman",
          isbn: "212121212",
          category: "T√¢m l√Ω h·ªçc",
          description:
            "Kh√°m ph√° hai h·ªá th·ªëng chi ph·ªëi c√°ch ch√∫ng ta suy nghƒ© v√† ra quy·∫øt ƒë·ªãnh.",
          cover: "https://m.media-amazon.com/images/I/514jG55j6TL.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/thinking-fast-and-slow.pdf",
          pages: 499,
          publishedYear: 2011,
          rating: 4.7,
        },
        {
          title: "Thi√™n Ch√∫a v√† Con ng∆∞·ªùi",
          author: "Albert Camus",
          isbn: "222222222",
          category: "Tri·∫øt h·ªçc",
          description:
            "T·∫≠p h·ª£p c√°c ti·ªÉu lu·∫≠n v√† b√†i ph√°t bi·ªÉu c·ªßa nh√† vƒÉn ƒëo·∫°t gi·∫£i Nobel.",
          cover: "https://covers.openlibrary.org/b/id/13253805-L.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/the-stranger.pdf",
          pages: 200,
          publishedYear: 1942,
          rating: 4.3,
        },
        {
          title: "K·ªπ nƒÉng giao ti·∫øp hi·ªáu qu·∫£",
          author: "Zig Ziglar",
          isbn: "232323232",
          category: "K·ªπ nƒÉng s·ªëng",
          description:
            "C√°c nguy√™n t·∫Øc ƒë·ªÉ giao ti·∫øp r√µ r√†ng, thuy·∫øt ph·ª•c v√† t·∫°o ·∫•n t∆∞·ª£ng t·ªët.",
          cover: "https://m.media-amazon.com/images/I/51r5wQ2p6ML.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/communication-skills.pdf",
          pages: 250,
          publishedYear: 1998,
          rating: 4.1,
        },
        {
          title: "T√†i ch√≠nh C√° nh√¢n",
          author: "Robert Kiyosaki",
          isbn: "242424242",
          category: "Kinh t·∫ø",
          description:
            "Kh√°i ni·ªám c∆° b·∫£n v√† c√°c chi·∫øn l∆∞·ª£c ƒë·∫ßu t∆∞ cho ng∆∞·ªùi m·ªõi b·∫Øt ƒë·∫ßu.",
          cover: "https://m.media-amazon.com/images/I/51wU0Fj1HFL.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/rich-dad-poor-dad.pdf",
          pages: 200,
          publishedYear: 1997,
          rating: 4.6,
        },

        {
          title: "Sherlock Holmes: Tuy·ªÉn t·∫≠p",
          author: "Arthur Conan Doyle",
          isbn: "313131313",
          category: "Ti·ªÉu thuy·∫øt",
          description:
            "T·ªïng h·ª£p c√°c v·ª• √°n kinh ƒëi·ªÉn c·ªßa th√°m t·ª≠ l·ª´ng danh Sherlock Holmes.",
          cover: "https://m.media-amazon.com/images/I/51-mYjS8QWL.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/sherlock-holmes.pdf",
          pages: 1024,
          publishedYear: 1892,
          rating: 4.8,
        },
        {
          title: "V≈© tr·ª• trong v·ªè h·∫°t d·∫ª",
          author: "Stephen Hawking",
          isbn: "323232323",
          category: "Khoa h·ªçc",
          description:
            "Gi·∫£i th√≠ch v·ªÅ v·∫≠t l√Ω thi√™n vƒÉn v√† c∆° h·ªçc l∆∞·ª£ng t·ª≠ m·ªôt c√°ch d·ªÖ hi·ªÉu.",
          cover: "https://m.media-amazon.com/images/I/51-xR2tPzQL.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/universe-in-a-nutshell.pdf",
          pages: 216,
          publishedYear: 2001,
          rating: 4.6,
          hot: true,
        },
        {
          title: "Vi·ªát Nam S·ª≠ L∆∞·ª£c",
          author: "Tr·∫ßn Tr·ªçng Kim",
          isbn: "333333333",
          category: "L·ªãch s·ª≠",
          description:
            "T√°c ph·∫©m kinh ƒëi·ªÉn v·ªÅ l·ªãch s·ª≠ Vi·ªát Nam t·ª´ th·ªùi H·ªìng B√†ng ƒë·∫øn nƒÉm 1920.",
          cover: "https://m.media-amazon.com/images/I/51tE-x-UaCL.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/vietnam-history.pdf",
          pages: 650,
          publishedYear: 1920,
          rating: 4.9,
        },
        {
          title: "Ng√¥n ng·ªØ c∆° th·ªÉ",
          author: "Allan Pease",
          isbn: "343434343",
          category: "K·ªπ nƒÉng s·ªëng",
          description:
            "C√°ch ƒë·ªçc suy nghƒ© ng∆∞·ªùi kh√°c th√¥ng qua c·ª≠ ch·ªâ v√† bi·ªÉu hi·ªán kh√¥ng l·ªùi.",
          cover: "https://m.media-amazon.com/images/I/41-lF-r8BPL.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/body-language.pdf",
          pages: 224,
          publishedYear: 1981,
          rating: 4.3,
        },
        {
          title: "Nh√† tr·ªã li·ªáu v√† kh√°ch h√†ng",
          author: "Irvin D. Yalom",
          isbn: "353535353",
          category: "T√¢m l√Ω h·ªçc",
          description:
            "C√°c c√¢u chuy·ªán th·ª±c t·∫ø v·ªÅ tr·ªã li·ªáu t√¢m l√Ω, kh√°m ph√° n·ªói s·ª£ h√£i v√† √Ω nghƒ©a cu·ªôc s·ªëng.",
          cover: "https://m.media-amazon.com/images/I/5152q7v+QQL.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/the-gift-of-therapy.pdf",
          pages: 304,
          publishedYear: 2002,
          rating: 4.7,
        },
        {
          title: "ƒêi t√¨m l·∫Ω s·ªëng",
          author: "Viktor Frankl",
          isbn: "363636363",
          category: "Tri·∫øt h·ªçc",
          description:
            "Cu·ªôc ƒë·ªùi t√°c gi·∫£ trong tr·∫°i t·∫≠p trung v√† kh√°m ph√° √Ω nghƒ©a cu·ªôc s·ªëng (Logotherapy).",
          cover: "https://m.media-amazon.com/images/I/51g7-1sR5PL.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/mans-search-for-meaning.pdf",
          pages: 165,
          publishedYear: 1946,
          rating: 4.9,
          featured: true,
        },
        {
          title: "Tr√≠ tu·ªá c·∫£m x√∫c",
          author: "Daniel Goleman",
          isbn: "373737373",
          category: "T√¢m l√Ω h·ªçc",
          description:
            "T·∫°i sao EQ l·∫°i quan tr·ªçng h∆°n IQ, v√† c√°ch ph√°t tri·ªÉn n√≥.",
          cover: "https://m.media-amazon.com/images/I/51j1Q89bU5L.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/emotional-intelligence.pdf",
          pages: 384,
          publishedYear: 1995,
          rating: 4.5,
        },
        {
          title: "Qu·∫£n l√Ω d·ª± √°n A-Z",
          author: "Ken Schwaber",
          isbn: "383838383",
          category: "K·ªπ nƒÉng s·ªëng",
          description:
            "H∆∞·ªõng d·∫´n th·ª±c h√†nh qu·∫£n l√Ω d·ª± √°n theo ph∆∞∆°ng ph√°p Agile v√† Scrum.",
          cover: "https://m.media-amazon.com/images/I/51m-n-8oFLL.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/scrum-guide.pdf",
          pages: 200,
          publishedYear: 2001,
          rating: 4.2,
        },
        {
          title: "L·ªãch s·ª≠ v·∫°n v·∫≠t",
          author: "Bill Bryson",
          isbn: "393939393",
          category: "Khoa h·ªçc",
          description:
            "Kh√°m ph√° nh·ªØng ƒëi·ªÅu c∆° b·∫£n nh·∫•t c·ªßa khoa h·ªçc v√† l·ªãch s·ª≠ Tr√°i ƒê·∫•t.",
          cover: "https://m.media-amazon.com/images/I/51mN-w0-rPL.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/a-short-history-of-nearly-everything.pdf",
          pages: 544,
          publishedYear: 2003,
          rating: 4.6,
        },
        {
          title: "H·∫°t gi·ªëng t√¢m h·ªìn",
          author: "Jack Canfield",
          isbn: "4040404040",
          category: "K·ªπ nƒÉng s·ªëng",
          description:
            "Tuy·ªÉn t·∫≠p nh·ªØng c√¢u chuy·ªán √Ω nghƒ©a truy·ªÅn c·∫£m h·ª©ng v√† ni·ªÅm tin v√†o cu·ªôc s·ªëng.",
          cover: "https://m.media-amazon.com/images/I/51F8jN+o37L.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/chicken-soup-for-the-soul.pdf",
          pages: 300,
          publishedYear: 1993,
          rating: 4.1,
        },
        {
          title: "Tri·∫øt h·ªçc cho ng∆∞·ªùi m·ªõi b·∫Øt ƒë·∫ßu",
          author: "Simon Blackburn",
          isbn: "4141414141",
          category: "Tri·∫øt h·ªçc",
          description:
            "Gi·ªõi thi·ªáu v·ªÅ c√°c kh√°i ni·ªám, nh√† t∆∞ t∆∞·ªüng v√† tr∆∞·ªùng ph√°i tri·∫øt h·ªçc l·ªõn.",
          cover: "https://m.media-amazon.com/images/I/51i1T9M+kDL.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/philosophy-beginners.pdf",
          pages: 350,
          publishedYear: 1999,
          rating: 4.0,
        },
        {
          title: "C√¥ng ngh·ªá Blockchain",
          author: "Melanie Swan",
          isbn: "4242424242",
          category: "Khoa h·ªçc",
          description:
            "T·∫•t c·∫£ nh·ªØng g√¨ c·∫ßn bi·∫øt v·ªÅ c√¥ng ngh·ªá chu·ªói kh·ªëi v√† ·ª©ng d·ª•ng c·ªßa n√≥.",
          cover: "https://m.media-amazon.com/images/I/41-i2o-sH8L.jpg",
          pdf: "https://www.planetebook.com/free-ebooks/blockchain-blueprint.pdf",
          pages: 240,
          publishedYear: 2015,
          rating: 4.4,
        },
      ];

      let initialUsers = JSON.parse(localStorage.getItem("users"));
      if (!initialUsers || initialUsers.length === 0) {
        initialUsers = [
          {
            name: "ƒê·ªôc Gi·∫£ Th·ª≠ Nghi·ªám",
            email: "user@test.com",
            password: "password",
            favorites: ["123456789", "444444444", "202020202", "323232323"],
            borrowedBooks: [
              {
                isbn: "987654321",
                borrowDate: "01/01/2025",
                dueDate: "15/01/2025",
              },
              {
                isbn: "888888888",
                borrowDate: "10/11/2025",
                dueDate: "24/11/2025",
              }, 
            ],
            contributions: [
              {
                name: "S√°ch Hay V·ªÅ Tr√≠ Tu·ªá Nh√¢n T·∫°o",
                link: "https://example.com/ai-book",
                status: "ƒê√£ duy·ªát",
                date: "05/11/2025",
              },
              {
                name: "Tuy·ªÉn t·∫≠p th∆° 2024",
                link: "ƒê√£ g·ª≠i qua email",
                status: "ƒêang ch·ªù duy·ªát",
                date: "10/11/2025",
              },
            ],
            created: "01/01/2025",
            updated: "15/11/2025",
            activityHistory: [
              {
                time: "08:00 PM, 15/11/2025",
                action: "ƒêƒÉng nh·∫≠p",
                detail: "ƒêƒÉng nh·∫≠p th√†nh c√¥ng v√†o h·ªá th·ªëng.",
                type: "info",
              },
              {
                time: "05:00 PM, 15/11/2025",
                action: "ƒê√≥ng g√≥p s√°ch",
                detail:
                  'ƒê√£ g·ª≠i ƒë√≥ng g√≥p s√°ch <span class="text-book">Tuy·ªÉn t·∫≠p th∆° 2024</span>.',
                type: "info",
              },
              {
                time: "04:00 PM, 15/11/2025",
                action: "M∆∞·ª£n s√°ch",
                detail:
                  'ƒê√£ m∆∞·ª£n s√°ch <span class="text-book">Ti·ªÉu thuy·∫øt 1984</span>. H·∫°n tr·∫£: 24/11/2025.',
                type: "success",
              },
            ],
          },
        ];
        localStorage.setItem("users", JSON.stringify(initialUsers));
      }

      let users = initialUsers;
      let currentUser = JSON.parse(
        localStorage.getItem("currentUser") || "null"
      );

      const bookModal = new bootstrap.Modal(
        document.getElementById("bookModal")
      );
      const contributionModal = new bootstrap.Modal(
        document.getElementById("contributionModal")
      );
      const changePasswordModal = new bootstrap.Modal(
        document.getElementById("changePasswordModal")
      );

      const authPanel = document.getElementById("authPanel");
      const profilePage = document.getElementById("profilePage");
      const catalogArea = document.getElementById("catalogArea");
      const hotBooksSection = document.getElementById("hotBooksSection");
      const featuredBookSection = document.getElementById(
        "featuredBookSection"
      );
      const contributionPage = document.getElementById("contributionPage");

      const booksPerPage = 12;
      let currentPage = 1;
      let isLogin = true;
      let isViewingFavorites = false;

      function showToast(message, type = "info") {
        const toastContainer = document.getElementById("toastContainer");
        const toast = document.createElement("div");
        toast.className = `toast-message toast-${type}`;
        let icon = "";
        if (type === "success")
          icon = '<i class="fas fa-check-circle me-2"></i>';
        else if (type === "error")
          icon = '<i class="fas fa-exclamation-triangle me-2"></i>';
        else icon = '<i class="fas fa-info-circle me-2"></i>';
        toast.innerHTML = icon + message;

        toastContainer.prepend(toast);

        setTimeout(() => {
          toast.style.opacity = "0";
          toast.style.transform = "translateY(-20px)";
          setTimeout(() => toast.remove(), 500);
        }, 3500);
      }

      function getCurrentTime() {
        return (
          new Date().toLocaleTimeString("vi-VN", {
            hour: "2-digit",
            minute: "2-digit",
          }) +
          ", " +
          new Date().toLocaleDateString("vi-VN")
        );
      }

      function updateUser(user) {
        const userIndex = users.findIndex((u) => u.email === user.email);

        if (userIndex > -1) {
          users[userIndex] = user;
        } else {
          users.push(user);
        }

        localStorage.setItem("users", JSON.stringify(users));

        if (currentUser && currentUser.email === user.email) {
          currentUser = user;
          localStorage.setItem("currentUser", JSON.stringify(currentUser));
        }
      }

      function recordActivity(action, detail, type = "info") {
        if (!currentUser) return;

        const latestUser = users.find((u) => u.email === currentUser.email);
        if (!latestUser) return;

        if (!latestUser.activityHistory) {
          latestUser.activityHistory = [];
        }

        const activity = {
          time: getCurrentTime(),
          action,
          detail,
          type,
        };

        latestUser.activityHistory.unshift(activity);

        if (latestUser.activityHistory.length > 10) {
          latestUser.activityHistory.pop();
        }

        updateUser(latestUser);
      }

      function fillContributionForm() {
        const contributorName = document.getElementById("contributorName");
        const contributorEmail = document.getElementById("contributorEmail");

        document.getElementById("contributedTitle").value = "";
        document.getElementById("contributedLink").value = "";

        if (currentUser) {
          const latestUser =
            users.find((u) => u.email === currentUser.email) || currentUser;

          contributorName.value = latestUser.name || "";
          contributorEmail.value = latestUser.email || "";
          contributorEmail.setAttribute("disabled", "true");
          contributorEmail.style.backgroundColor = "#e9ecef";
          contributorName.removeAttribute("disabled");
        } else {
          contributorName.value = "";
          contributorEmail.value = "";
          contributorName.removeAttribute("disabled");
          contributorEmail.removeAttribute("disabled");
          contributorEmail.style.backgroundColor = "#fff";
        }
      }

      function updateActiveNav(target) {
        document.querySelectorAll(".navbar-nav .nav-link").forEach((link) => {
          link.classList.remove("active");
        });

        if (target === "home") {
          document.getElementById("navHomeLink").classList.add("active");
        } else if (
          target === "catalog" ||
          target === "favorites" ||
          target === "borrowed" ||
          target === "profile"
        ) {
          document.getElementById("navCatalogLink").classList.add("active");
        } else if (target === "contributionPage") {
          document.getElementById("navContributeLink").classList.add("active");
        }
      }

      function handleNavClick(target, goToProfile = false) {
        profilePage.style.display = "none";
        catalogArea.style.display = "none";
        contributionPage.style.display = "none";
        document.getElementById("heroBanner").style.display = "none";
        hotBooksSection.style.display = "none";
        featuredBookSection.style.display = "none";
        authPanel.style.display = "none";

        if (
          target !== "profile" &&
          target !== "favorites" &&
          target !== "borrowed"
        ) {
          isViewingFavorites = false;
        }

        if (target === "home") {
          catalogArea.style.display = "flex";
          document.getElementById("heroBanner").style.display = "block";
          hotBooksSection.style.display = "block";
          featuredBookSection.style.display = "block";
          document.getElementById("catalogTitle").innerHTML =
            "üìö T·∫•t C·∫£ S√°ch Hi·ªán C√≥";
          renderHotBooks();
          renderFeaturedBook();
          renderCatalog(false);
          updateActiveNav("home");
          if (!currentUser) authPanel.style.display = "block";
          window.scrollTo({ top: 0, behavior: "smooth" });
          return;
        }

        if (target === "contributionPage") {
          contributionPage.style.display = "block";
          renderContributionPage();
          updateActiveNav("contributionPage");
          window.scrollTo({ top: 0, behavior: "smooth" });
          return;
        }

        if (
          target === "profile" ||
          target === "favorites" ||
          target === "borrowed"
        ) {
          if (!currentUser) {
            promptLogin();
            return;
          }

          renderProfilePage();
          profilePage.style.display = "block";

          let tabElementId = "info-tab";
          if (target === "favorites") tabElementId = "favorites-tab";
          else if (target === "borrowed") tabElementId = "borrowed-tab";

          const tabElement = document.getElementById(tabElementId);
          if (tabElement) new bootstrap.Tab(tabElement).show();

          if (target === "favorites" && goToProfile === false) {
            isViewingFavorites = true;
            renderCatalog(true);
            document.getElementById("catalogArea").style.display = "flex";
            document.getElementById("profilePage").style.display = "none";
          } else {
            isViewingFavorites = false;
          }
          updateActiveNav("catalog");
          window.scrollTo({ top: 0, behavior: "smooth" });
          return;
        }

        catalogArea.style.display = "flex";
        document.getElementById("catalogTitle").innerHTML =
          "üìö T·∫•t C·∫£ S√°ch Hi·ªán C√≥";
        renderCatalog(false);
        updateActiveNav("catalog");
        if (!currentUser) authPanel.style.display = "block";
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      function promptLogin() {
        showToast("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ s·ª≠ d·ª•ng ch·ª©c nƒÉng n√†y.", "info");
        handleNavClick("catalog");
        toggleAuthMode(true);
        authPanel.style.display = "block";
        document.getElementById("profileDropdown").style.display = "none";
      }

      function renderHotBooks() {
        const hotBooks = books.filter((b) => b.hot).slice(0, 4);
        const container = document.getElementById("hotBooksContainer");
        container.innerHTML = "";

        if (hotBooks.length === 0) {
          hotBooksSection.style.display = "none";
          return;
        }
        hotBooksSection.style.display = "block";

        hotBooks.forEach((book, index) => {
          const encodedBookJson = encodeURIComponent(JSON.stringify(book));

          const latestUser = users.find(
            (u) => u.email === (currentUser ? currentUser.email : null)
          );
          const isCurrentlyBorrowed =
            latestUser &&
            latestUser.borrowedBooks.some((b) => b.isbn === book.isbn);

          let bookActionHTML;
          if (currentUser) {
            if (isCurrentlyBorrowed) {
              bookActionHTML = `<button class="btn btn-sm btn-borrowed w-100 mt-2" disabled>ƒêang M∆∞·ª£n</button>`;
            } else {
              bookActionHTML = `<button class="btn btn-sm btn-success w-100 mt-2" onclick='borrowBook(JSON.parse(decodeURIComponent("${encodedBookJson}")))'><i class="fas fa-exchange-alt"></i> M∆∞·ª£n S√°ch</button>`;
            }
          } else {
            bookActionHTML = `<button class="btn btn-sm btn-primary w-100 mt-2" onclick="promptLogin()"><i class="fas fa-sign-in-alt"></i> ƒêƒÉng nh·∫≠p</button>`;
          }

          const col = document.createElement("div");
          col.className = `col-lg-3 col-md-6 col-12 mb-4 animate__animated animate__fadeInUp`;
          col.style.setProperty("--animate-delay", `${index * 0.1}s`);

          const card = document.createElement("div");
          card.className = "card card-book h-100";
          card.innerHTML = `
            <div class="book-cover-container" onclick="${
              currentUser
                ? `openBookModal(JSON.parse(decodeURIComponent("${encodedBookJson}")))`
                : `promptLogin()`
            }">
                <img src="${book.cover}" class="book-cover"/>
            </div>
            <div class="card-body d-flex flex-column justify-content-between">
                <div class="book-info">
                    <h6 class="card-title">${book.title}</h6>
                    <p class="mb-1 text-muted" style="font-size: 0.9rem;">${
                      book.author
                    }</p>
                    <p class="mb-2">${renderRating(book.rating)}</p>
                </div>
                ${bookActionHTML}
            </div>
        `;
          container.appendChild(col).appendChild(card);
        });
      }

      function renderFeaturedBook() {
        const featuredBook = books.find((b) => b.featured);
        const content = document.getElementById("featuredBookContent");

        if (!featuredBook) {
          featuredBookSection.style.display = "none";
          return;
        }
        featuredBookSection.style.display = "block";

        const encodedBookJson = encodeURIComponent(
          JSON.stringify(featuredBook)
        );

        const latestUser = users.find(
          (u) => u.email === (currentUser ? currentUser.email : null)
        );
        const isBorrowed = latestUser && isBookBorrowed(featuredBook.isbn);

        const borrowButtonHTML = isBorrowed
          ? `<button class="btn btn-borrowed mt-3 me-2" disabled><i class="fas fa-check"></i> ƒêang M∆∞·ª£n</button>`
          : `<button class="btn btn-success mt-3 me-2" onclick='borrowBook(JSON.parse(decodeURIComponent("${encodedBookJson}")))'><i class="fas fa-exchange-alt"></i> M∆∞·ª£n S√°ch</button>`;

        const actionButtons = currentUser
          ? `<div class="d-flex gap-2">
             ${borrowButtonHTML}
             <button class="btn btn-primary mt-3" onclick='openBookModal(JSON.parse(decodeURIComponent("${encodedBookJson}")))'><i class="fas fa-search"></i> Chi ti·∫øt</button>
           </div>`
          : `<button class="btn btn-primary mt-3" onclick="promptLogin()"><i class="fas fa-sign-in-alt"></i> ƒêƒÉng nh·∫≠p ƒë·ªÉ ƒë·ªçc</button>`;

        content.innerHTML = `
        <div class="col-md-4 text-center p-4">
            <img src="${
              featuredBook.cover
            }" class="img-fluid featured-cover animate__animated animate__zoomIn" alt="${
          featuredBook.title
        }" style="max-height: 300px;">
        </div>
        <div class="col-md-8 d-flex align-items-center">
            <div class="card-body featured-content animate__animated animate__fadeInRight">
                <span class="badge bg-primary mb-2"><i class="fas fa-trophy me-1"></i> S√°ch N·ªïi B·∫≠t/ƒê·ªÅ xu·∫•t</span>
                <h4 class="card-title text-dark">${featuredBook.title}</h4>
                <p class="card-text"><b>T√°c gi·∫£:</b> ${featuredBook.author}</p>
                <p class="card-text">${renderRating(featuredBook.rating)}</p>
                <p class="card-text text-muted" style="font-size: 0.95rem;">${featuredBook.description.substring(
                  0,
                  200
                )}...</p>
                ${actionButtons}
            </div>
        </div>
    `;
      }

      function updateLoginState() {
        const profileDropdown = document.getElementById("profileDropdown");
        const loginButton = document.getElementById("btnLoginRegister");
        const authPanel = document.getElementById("authPanel");

        if (currentUser) {
          const latestUser = users.find((u) => u.email === currentUser.email);
          if (latestUser) currentUser = latestUser;

          profileDropdown.style.display = "block";
          loginButton.style.display = "none";
          authPanel.style.display = "none";
          document.getElementById("navUserName").textContent = currentUser.name;
          document.getElementById("dropdownUserName").textContent =
            currentUser.name;

          if (contributionPage.style.display !== "none") {
            renderContributionPage();
          }
        } else {
          profileDropdown.style.display = "none";
          loginButton.style.display = "block";

          if (
            catalogArea.style.display !== "none" ||
            document.getElementById("heroBanner").style.display !== "none"
          ) {
            authPanel.style.display = "block";
            toggleAuthMode(true);
          }

          if (contributionPage.style.display !== "none") {
            renderContributionPage();
          }
        }
      }

      function toggleAuthMode(loginMode) {
        isLogin = loginMode;
        document.getElementById("authTitle").innerHTML = isLogin
          ? '<i class="fas fa-sign-in-alt"></i> ƒêƒÉng nh·∫≠p v√†o th∆∞ vi·ªán'
          : '<i class="fas fa-user-plus"></i> ƒêƒÉng k√Ω t√†i kho·∫£n m·ªõi';
        document.getElementById("authBtn").textContent = isLogin
          ? "ƒêƒÉng nh·∫≠p"
          : "ƒêƒÉng k√Ω";
        document.getElementById("authNameDiv").style.display = isLogin
          ? "none"
          : "block";
        document.getElementById("toggleAuth").innerHTML = isLogin
          ? "Ch∆∞a c√≥ t√†i kho·∫£n? ƒêƒÉng k√Ω ngay!"
          : "ƒê√£ c√≥ t√†i kho·∫£n? ƒêƒÉng nh·∫≠p!";
        document.getElementById("authEmail").value = "";
        document.getElementById("authPassword").value = "";
        document.getElementById("authName").value = "";
      }

      function handleAuthSubmit(e) {
        e.preventDefault();
        const email = document.getElementById("authEmail").value;
        const password = document.getElementById("authPassword").value;
        const name =
          document.getElementById("authName").value || email.split("@")[0];

        if (isLogin) {
          const user = users.find(
            (u) => u.email === email && u.password === password
          );
          if (user) {
            currentUser = user;
            localStorage.setItem("currentUser", JSON.stringify(currentUser));
            showToast(`Ch√†o m·ª´ng tr·ªü l·∫°i, ${currentUser.name}!`, "success");

            recordActivity(
              "ƒêƒÉng nh·∫≠p",
              `ƒêƒÉng nh·∫≠p th√†nh c√¥ng v√†o h·ªá th·ªëng.`,
              "info"
            );

            updateLoginState();
            handleNavClick("home");
          } else {
            showToast(
              "Email ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng. Vui l√≤ng th·ª≠ l·∫°i.",
              "error"
            );
          }
        } else {
          if (users.some((u) => u.email === email)) {
            showToast("Email ƒë√£ ƒë∆∞·ª£c ƒëƒÉng k√Ω. Vui l√≤ng ƒêƒÉng nh·∫≠p!", "error");
            return;
          }
          if (password.length < 6) {
            showToast("M·∫≠t kh·∫©u ph·∫£i d√†i √≠t nh·∫•t 6 k√Ω t·ª±.", "error");
            return;
          }
          const newUser = {
            name,
            email,
            password,
            favorites: [],
            borrowedBooks: [],
            contributions: [],
            created: new Date().toLocaleDateString("vi-VN"),
            updated: new Date().toLocaleDateString("vi-VN"),
            activityHistory: [],
          };

          currentUser = newUser;
          updateUser(newUser);

          recordActivity("ƒêƒÉng k√Ω", `T·∫°o t√†i kho·∫£n m·ªõi th√†nh c√¥ng.`, "success");

          showToast("ƒêƒÉng k√Ω th√†nh c√¥ng! Ch√†o m·ª´ng b·∫°n.", "success");
          updateLoginState();
          handleNavClick("home");
        }
      }

      function handleLogout() {
        recordActivity("ƒêƒÉng xu·∫•t", `ƒêƒÉng xu·∫•t kh·ªèi h·ªá th·ªëng.`, "info");

        currentUser = null;
        localStorage.removeItem("currentUser");
        showToast("B·∫°n ƒë√£ ƒëƒÉng xu·∫•t th√†nh c√¥ng.", "info");
        updateLoginState();
        isViewingFavorites = false;
        handleNavClick("home");
      }

      function handleChangePassword(e) {
        e.preventDefault();
        if (!currentUser) {
          changePasswordModal.hide();
          return promptLogin();
        }

        const currentPassword =
          document.getElementById("currentPassword").value;
        const newPassword = document.getElementById("newPassword").value;
        const confirmNewPassword =
          document.getElementById("confirmNewPassword").value;

        const latestUser = users.find((u) => u.email === currentUser.email);

        if (currentPassword !== latestUser.password) {
          showToast("M·∫≠t kh·∫©u hi·ªán t·∫°i kh√¥ng ƒë√∫ng.", "error");
          return;
        }

        if (newPassword.length < 6) {
          showToast("M·∫≠t kh·∫©u m·ªõi ph·∫£i d√†i √≠t nh·∫•t 6 k√Ω t·ª±.", "error");
          return;
        }

        if (newPassword !== confirmNewPassword) {
          showToast("X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi kh√¥ng kh·ªõp.", "error");
          return;
        }

        if (newPassword === currentPassword) {
          showToast("M·∫≠t kh·∫©u m·ªõi kh√¥ng ƒë∆∞·ª£c tr√πng v·ªõi m·∫≠t kh·∫©u c≈©.", "error");
          return;
        }

        latestUser.password = newPassword;
        latestUser.updated = new Date().toLocaleDateString("vi-VN");
        updateUser(latestUser);

        recordActivity(
          "ƒê·ªïi m·∫≠t kh·∫©u",
          `Thay ƒë·ªïi m·∫≠t kh·∫©u t√†i kho·∫£n th√†nh c√¥ng.`,
          "warning"
        );

        changePasswordModal.hide();
        document.getElementById("changePasswordForm").reset();
        showToast(
          "ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng! Vui l√≤ng s·ª≠ d·ª•ng m·∫≠t kh·∫©u m·ªõi t·ª´ l·∫ßn ƒëƒÉng nh·∫≠p sau.",
          "success"
        );
        renderProfilePage();
      }

      function handleContributionSubmit(e) {
        e.preventDefault();

        const contributorName =
          document.getElementById("contributorName").value || "Kh√°ch ·∫©n danh";
        const contributorEmail = document.getElementById("contributorEmail")
          .disabled
          ? currentUser.email
          : document.getElementById("contributorEmail").value;

        const contributedTitle =
          document.getElementById("contributedTitle").value;
        const contributedLink =
          document.getElementById("contributedLink").value;

        if (!contributorEmail || !contributedTitle || !contributedLink) {
          showToast("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß c√°c tr∆∞·ªùng b·∫Øt bu·ªôc.", "error");
          return;
        }

        const contribution = {
          name: contributedTitle,
          link: contributedLink,
          status: "ƒêang ch·ªù duy·ªát",
          date: new Date().toLocaleDateString("vi-VN"),
        };

        if (currentUser) {
          const latestUser =
            users.find((u) => u.email === currentUser.email) || currentUser;
          if (!latestUser.contributions) {
            latestUser.contributions = [];
          }
          latestUser.contributions.unshift(contribution);
          updateUser(latestUser);
          recordActivity(
            "ƒê√≥ng g√≥p s√°ch",
            `ƒê√£ g·ª≠i ƒë√≥ng g√≥p s√°ch <span class="text-book">${contributedTitle}</span>.`,
            "info"
          );
        }

        showToast(
          "C·∫£m ∆°n b·∫°n ƒë√£ ƒë√≥ng g√≥p! Ch√∫ng t√¥i s·∫Ω xem x√©t s·ªõm.",
          "success"
        );
        contributionModal.hide();

        fillContributionForm();

        if (contributionPage.style.display !== "none") {
          renderContributionPage();
        }
      }

      function renderContributionPage() {
        const latestUser = currentUser
          ? users.find((u) => u.email === currentUser.email) || currentUser
          : null;
        const myContributionsContainer = document.getElementById(
          "myContributionsContainer"
        );

        document.getElementById("totalContributions").textContent =
          53 +
          (latestUser
            ? latestUser.contributions.filter((c) => c.status === "ƒê√£ duy·ªát")
                .length
            : 0);
        document.getElementById("contributorCount").textContent =
          12 + (latestUser ? 1 : 0);

        if (latestUser) {
          const contributions = latestUser.contributions || [];

          let html = `<h6><i class="fas fa-clipboard-list me-1 text-info"></i> ${contributions.length} ƒê√≥ng g√≥p ƒë√£ g·ª≠i:</h6>`;

          if (contributions.length === 0) {
            html +=
              '<p class="text-muted small">B·∫°n ch∆∞a g·ª≠i ƒë√≥ng g√≥p n√†o. H√£y g·ª≠i ngay!</p>';
          } else {
            contributions.slice(0, 5).forEach((contribution) => {
              let statusBadgeClass = "bg-warning";
              let borderColor = "border-warning";
              if (contribution.status === "ƒê√£ duy·ªát") {
                statusBadgeClass = "bg-success";
                borderColor = "border-success";
              } else if (contribution.status === "T·ª´ ch·ªëi") {
                statusBadgeClass = "bg-danger";
                borderColor = "border-danger";
              }

              html += `
                    <div class="card p-2 mb-2 ${borderColor} shadow-sm" style="font-size: 0.9rem;">
                        <p class="mb-1 fw-bold">${contribution.name}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="badge ${statusBadgeClass}">${contribution.status}</span>
                            <span class="text-muted" style="font-size: 0.75rem;">${contribution.date}</span>
                        </div>
                    </div>
                `;
            });
          }

          myContributionsContainer.innerHTML = html;
        } else {
          myContributionsContainer.innerHTML = `
            <p class="text-muted" style="font-size: 0.9rem;">Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ theo d√µi l·ªãch s·ª≠ v√† tr·∫°ng th√°i c√°c ƒë√≥ng g√≥p ƒë√£ g·ª≠i.</p>
            <button class="btn btn-sm btn-outline-primary w-100" onclick="promptLogin()"><i class="fas fa-sign-in-alt me-1"></i> ƒêƒÉng nh·∫≠p</button>
        `;
        }
      }

      function getBookByISBN(isbn) {
        return books.find((b) => b.isbn === isbn);
      }

      function isBookBorrowed(isbn) {
        if (!currentUser || !currentUser.borrowedBooks) return false;
        const latestUser =
          users.find((u) => u.email === currentUser.email) || currentUser;
        return latestUser.borrowedBooks.some((b) => b.isbn === isbn);
      }

      function renderRating(rating) {
        const fullStars = Math.floor(rating);
        const hasHalfStar = rating % 1 !== 0;
        let html = "";
        for (let i = 0; i < 5; i++) {
          if (i < fullStars) {
            html += '<i class="fas fa-star"></i>';
          } else if (i === fullStars && hasHalfStar) {
            html += '<i class="fas fa-star-half-alt"></i>';
          } else {
            html += '<i class="far fa-star"></i>';
          }
        }
        return `<span class="book-rating">${html} <span style="font-size: 0.9rem; color: #6c757d;">(${rating.toFixed(
          1
        )})</span></span>`;
      }

      function toggleFavorite(e, isbn) {
        e.stopPropagation();
        if (!currentUser) return promptLogin();

        const latestUser = users.find((u) => u.email === currentUser.email);
        if (!latestUser) return;

        const book = getBookByISBN(isbn);
        const bookIndex = latestUser.favorites.indexOf(isbn);

        if (bookIndex > -1) {
          latestUser.favorites.splice(bookIndex, 1);
          showToast(`ƒê√£ x√≥a "${book.title}" kh·ªèi danh s√°ch y√™u th√≠ch.`, "info");
          recordActivity(
            "X√≥a Y√™u th√≠ch",
            `ƒê√£ x√≥a s√°ch <span class="text-book">${book.title}</span> kh·ªèi m·ª•c y√™u th√≠ch.`,
            "info"
          );
        } else {
          latestUser.favorites.push(isbn);
          showToast(
            `ƒê√£ th√™m "${book.title}" v√†o danh s√°ch y√™u th√≠ch!`,
            "success"
          );
          recordActivity(
            "Th√™m Y√™u th√≠ch",
            `ƒê√£ th√™m s√°ch <span class="text-book">${book.title}</span> v√†o m·ª•c y√™u th√≠ch.`,
            "success"
          );
        }

        updateUser(latestUser);

        if (isViewingFavorites) {
          renderCatalog(true);
        }
        if (document.getElementById("profilePage").style.display !== "none") {
          renderProfilePage();
        } else {
          renderCatalog(false);
        }

        renderHotBooks();
        renderFeaturedBook();
      }

      function openBookModal(book) {
        if (!currentUser) return promptLogin();

        document.getElementById("modalCover").src = book.cover;
        document.getElementById("modalTitle").textContent = book.title;
        document.getElementById(
          "modalAuthor"
        ).textContent = `T√°c gi·∫£: ${book.author}`;
        document.getElementById("modalRating").innerHTML = renderRating(
          book.rating
        );
        document.getElementById("modalCategory").textContent = book.category;
        document.getElementById("modalISBN").textContent = book.isbn;
        document.getElementById("modalPublishedYear").textContent =
          book.publishedYear;
        document.getElementById("modalPages").textContent =
          book.pages + " trang";
        document.getElementById("modalDescription").textContent =
          book.description;

        const latestUser =
          users.find((u) => u.email === currentUser.email) || currentUser;
        const isBorrowed = latestUser.borrowedBooks.some(
          (b) => b.isbn === book.isbn
        );
        const actionsContainer = document.getElementById("modalActions");

        const borrowButtonHTML = isBorrowed
          ? `<button class="btn btn-borrowed" disabled><i class="fas fa-check"></i> ƒêang M∆∞·ª£n</button>`
          : `<button class="btn btn-success" onclick="borrowBook(JSON.parse(decodeURIComponent('${encodeURIComponent(
              JSON.stringify(book)
            )}'))); bookModal.hide();"><i class="fas fa-exchange-alt"></i> M∆∞·ª£n S√°ch (14 ng√†y)</button>`;

        const readButtonHTML = `<a href="${book.pdf}" target="_blank" class="btn btn-outline-primary"><i class="fas fa-book-reader"></i> T·∫£i/ƒê·ªçc PDF</a>`;

        actionsContainer.innerHTML = borrowButtonHTML + readButtonHTML;

        document.getElementById("pdfIframe").src = book.pdf;

        const descTabElement = document.getElementById("desc-tab");
        if (descTabElement) {
          const descTab = new bootstrap.Tab(descTabElement);
          descTab.show();
        }

        bookModal.show();
      }

      function borrowBook(book) {
        if (!currentUser) return promptLogin();

        const latestUser = users.find((u) => u.email === currentUser.email);
        if (!latestUser) return;

        if (latestUser.borrowedBooks.some((b) => b.isbn === book.isbn)) {
          showToast("B·∫°n ƒë√£ m∆∞·ª£n cu·ªën s√°ch n√†y r·ªìi.", "error");
          return;
        }

        const dueDate = new Date();
        dueDate.setDate(dueDate.getDate() + 14);
        const formattedDueDate = dueDate.toLocaleDateString("vi-VN");

        latestUser.borrowedBooks.push({
          isbn: book.isbn,
          borrowDate: new Date().toLocaleDateString("vi-VN"),
          dueDate: formattedDueDate,
        });

        updateUser(latestUser);

        recordActivity(
          "M∆∞·ª£n s√°ch",
          `ƒê√£ m∆∞·ª£n s√°ch <span class="text-book">${book.title}</span>. H·∫°n tr·∫£: ${formattedDueDate}.`,
          "success"
        );

        showToast(
          `B·∫°n ƒë√£ m∆∞·ª£n th√†nh c√¥ng s√°ch: ${book.title}. H·∫°n tr·∫£: ${formattedDueDate}`,
          "success"
        );
        renderCatalog(isViewingFavorites);
        renderHotBooks();
        renderFeaturedBook();
      }

      function returnBook(isbn) {
        if (!currentUser) return;

        const latestUser = users.find((u) => u.email === currentUser.email);
        if (!latestUser) return;

        const book = getBookByISBN(isbn);
        const bookIndex = latestUser.borrowedBooks.findIndex(
          (b) => b.isbn === isbn
        );

        if (bookIndex > -1) {
          latestUser.borrowedBooks.splice(bookIndex, 1);

          updateUser(latestUser);

          recordActivity(
            "Tr·∫£ s√°ch",
            `ƒê√£ tr·∫£ s√°ch <span class="text-book">${book.title}</span> th√†nh c√¥ng.`,
            "success"
          );

          showToast(`ƒê√£ tr·∫£ s√°ch "${book.title}" th√†nh c√¥ng.`, "success");
          renderProfilePage();
          renderCatalog(isViewingFavorites);
          renderHotBooks();
          renderFeaturedBook();
        }
      }

      function renderProfilePage() {
        if (!currentUser) return;

        const latestUser =
          users.find((u) => u.email === currentUser.email) || currentUser;

        document.getElementById("profileUserName").textContent =
          latestUser.name;
        document.getElementById("profileUserEmail").textContent =
          latestUser.email;
        document.getElementById("accountCreatedDate").textContent =
          latestUser.created;

        const contributionsCount = latestUser.contributions
          ? latestUser.contributions.length
          : 0;

        document.getElementById("borrowedCount").textContent =
          latestUser.borrowedBooks.length;
        document.getElementById("favoritesCount").textContent =
          latestUser.favorites.length;
        document.getElementById("viewCount").textContent = contributionsCount;

        renderActivityHistory();

        const borrowedList = document.getElementById("borrowedBooksList");
        borrowedList.innerHTML = "";
        if (latestUser.borrowedBooks.length === 0) {
          borrowedList.innerHTML =
            '<div class="col-12"><p class="text-muted"><i class="fas fa-frown me-1"></i> B·∫°n ch∆∞a m∆∞·ª£n cu·ªën s√°ch n√†o. H√£y <a href="#" onclick="handleNavClick(\'catalog\')">kh√°m ph√° danh m·ª•c</a>!</p></div>';
        } else {
          latestUser.borrowedBooks.forEach((borrow) => {
            const book = getBookByISBN(borrow.isbn);
            if (book) {
              const col = document.createElement("div");
              col.className = "col-lg-12";
              col.innerHTML = `
                    <div class="book-list-item d-flex align-items-center justify-content-between shadow-sm">
                        <div>
                            <h6><i class="fas fa-book me-2 text-primary"></i> ${book.title}</h6>
                            <p class="text-muted mb-1" style="font-size: 0.85rem;">T√°c gi·∫£: ${book.author}</p>
                            <p class="borrow-due-date mb-0" style="font-size: 0.9rem;"><i class="fas fa-calendar-times me-1 text-danger"></i> H·∫°n tr·∫£: ${borrow.dueDate}</p>
                        </div>
                        <button class="btn btn-sm btn-outline-success" onclick="returnBook('${book.isbn}')"><i class="fas fa-undo me-1"></i> Tr·∫£ s√°ch</button>
                    </div>
                `;
              borrowedList.appendChild(col);
            }
          });
        }

        const favoriteList = document.getElementById("favoriteBooksList");
        favoriteList.innerHTML = "";
        if (latestUser.favorites.length === 0) {
          favoriteList.innerHTML =
            '<div class="col-12"><p class="text-muted"><i class="fas fa-star me-1"></i> B·∫°n ch∆∞a th√™m s√°ch n√†o v√†o m·ª•c y√™u th√≠ch. H√£y <a href="#" onclick="handleNavClick(\'catalog\')">t√¨m ki·∫øm ngay</a>!</p></div>';
        } else {
          latestUser.favorites.forEach((isbn) => {
            const book = getBookByISBN(isbn);
            if (book) {
              const encodedBookJson = encodeURIComponent(JSON.stringify(book));
              const col = document.createElement("div");
              col.className = "col-lg-6 col-md-12";
              col.innerHTML = `
                    <div class="book-list-item shadow-sm">
                        <h6><i class="fas fa-heart me-1 text-danger"></i> ${book.title}</h6>
                        <p class="text-muted mb-2" style="font-size: 0.9rem;">T√°c gi·∫£: ${book.author}</p>
                        <div class="d-flex gap-2">
                            <button class="btn btn-sm btn-primary flex-grow-1" onclick='openBookModal(JSON.parse(decodeURIComponent("${encodedBookJson}")))'><i class="fas fa-eye me-1"></i> Chi ti·∫øt</button>
                            <button class="btn btn-sm btn-outline-danger" onclick="toggleFavorite(event, '${book.isbn}');"><i class="fas fa-times me-1"></i> X√≥a</button>
                        </div>
                    </div>
                `;
              favoriteList.appendChild(col);
            }
          });
        }
      }

      function renderActivityHistory() {
        const latestUser =
          users.find((u) => u.email === currentUser.email) || currentUser;

        const historyList = document.getElementById("activityHistoryList");
        historyList.innerHTML = "";

        const history = latestUser.activityHistory || [];

        if (history.length === 0) {
          historyList.innerHTML =
            '<li class="text-muted text-center py-3" style="border-left: none;"><i class="fas fa-box-open me-1"></i> Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o ƒë∆∞·ª£c ghi l·∫°i.</li>';
          return;
        }

        history.forEach((item) => {
          let iconClass;

          switch (item.action) {
            case "ƒêƒÉng k√Ω":
              iconClass = "fas fa-user-plus text-success";
              break;
            case "M∆∞·ª£n s√°ch":
              iconClass = "fas fa-exchange-alt text-success";
              break;
            case "Tr·∫£ s√°ch":
              iconClass = "fas fa-handshake text-info";
              break;
            case "Th√™m Y√™u th√≠ch":
              iconClass = "fas fa-heart text-danger";
              break;
            case "X√≥a Y√™u th√≠ch":
              iconClass = "far fa-trash-alt text-info";
              break;
            case "ƒê·ªïi m·∫≠t kh·∫©u":
              iconClass = "fas fa-key text-warning";
              break;
            case "ƒê√≥ng g√≥p s√°ch":
              iconClass = "fas fa-hands-helping text-info";
              break;
            case "ƒêƒÉng nh·∫≠p":
              iconClass = "fas fa-sign-in-alt text-primary";
              break;
            case "ƒêƒÉng xu·∫•t":
              iconClass = "fas fa-sign-out-alt text-secondary";
              break;
            default:
              iconClass = "fas fa-info-circle text-info";
          }

          const li = document.createElement("li");
          li.className = `history-item ${item.type}`;
          li.innerHTML = `
            <div class="history-content">
                <div class="history-text">
                    <span style="font-weight: 600; color: #343a40;"><i class="${iconClass} me-2"></i> ${
            item.action
          }:</span> ${item.detail.replace(item.action + " ", "")} 
                </div>
            </div>
            <div class="history-time">${item.time}</div>
        `;
          historyList.appendChild(li);
        });
      }

      function initializeFilters() {
        const yearFilter = document.getElementById("yearFilter");
        yearFilter.innerHTML = '<option value="All">T·∫•t c·∫£ c√°c nƒÉm</option>';
        const years = [...new Set(books.map((b) => b.publishedYear))].sort(
          (a, b) => b - a
        );
        years.forEach((year) => {
          const opt = document.createElement("option");
          opt.value = year;
          opt.textContent = year;
          yearFilter.appendChild(opt);
        });

        const categoryFilter = document.getElementById("categoryFilter");
        categoryFilter.innerHTML = '<option value="All">T·∫•t c·∫£</option>';
        const categories = [...new Set(books.map((b) => b.category))];
        categories.forEach((cat) => {
          const opt = document.createElement("option");
          opt.value = cat;
          opt.textContent = cat;
          categoryFilter.appendChild(opt);
        });

        yearFilter.addEventListener("change", () => {
          currentPage = 1;
          renderCatalog(isViewingFavorites);
        });
        document.getElementById("pageFilter").addEventListener("change", () => {
          currentPage = 1;
          renderCatalog(isViewingFavorites);
        });
      }

      function renderCatalog(viewFavorites = false) {
        isViewingFavorites = viewFavorites;
        let filteredBooks = [...books];

        const searchText = document
          .getElementById("searchInput")
          .value.trim()
          .toLowerCase();
        if (searchText)
          filteredBooks = filteredBooks.filter(
            (b) =>
              b.title.toLowerCase().includes(searchText) ||
              b.author.toLowerCase().includes(searchText)
          );

        const selectedCategory =
          document.getElementById("categoryFilter").value;
        if (selectedCategory && selectedCategory !== "All")
          filteredBooks = filteredBooks.filter(
            (b) => b.category === selectedCategory
          );

        const selectedYear = document.getElementById("yearFilter").value;
        if (selectedYear && selectedYear !== "All")
          filteredBooks = filteredBooks.filter(
            (b) => b.publishedYear === parseInt(selectedYear)
          );

        const selectedPages = document.getElementById("pageFilter").value;
        if (selectedPages !== "All") {
          filteredBooks = filteredBooks.filter((b) => {
            if (selectedPages === "<200") return b.pages < 200;
            if (selectedPages === "200-500")
              return b.pages >= 200 && b.pages <= 500;
            if (selectedPages === ">500") return b.pages > 500;
            return true;
          });
        }

        if (isViewingFavorites && currentUser) {
          const latestUser =
            users.find((u) => u.email === currentUser.email) || currentUser;
          filteredBooks = filteredBooks.filter((b) =>
            latestUser.favorites.includes(b.isbn)
          );
          document.getElementById("catalogTitle").innerHTML =
            "üíñ S√°ch Y√™u Th√≠ch C·ªßa B·∫°n";
          document.getElementById("filterPanel").style.display = "none";
          document.getElementById("catalogArea").style.display = "flex";
        } else {
          document.getElementById("catalogTitle").innerHTML =
            "üìö T·∫•t C·∫£ S√°ch Hi·ªán C√≥";
          document.getElementById("filterPanel").style.display = "block";
        }

        if (profilePage.style.display !== "none" && !isViewingFavorites) return;

        const sortOption = document.getElementById("sortOption").value;
        filteredBooks.sort((a, b) => {
          if (sortOption === "titleAsc") return a.title.localeCompare(b.title);
          if (sortOption === "titleDesc") return b.title.localeCompare(a.title);
          if (sortOption === "ratingDesc") return b.rating - a.rating;
          if (sortOption === "publishedYearDesc")
            return b.publishedYear - a.publishedYear;
          return 0;
        });

        if (filteredBooks.length === 0) {
          let message = isViewingFavorites
            ? "B·∫°n ch∆∞a th√™m s√°ch n√†o v√†o m·ª•c y√™u th√≠ch."
            : "Kh√¥ng t√¨m th·∫•y s√°ch n√†o kh·ªõp v·ªõi ti√™u ch√≠ t√¨m ki·∫øm/l·ªçc.";
          document.getElementById(
            "viewContainer"
          ).innerHTML = `<div class="col-12"><p class='text-muted animate__animated animate__fadeIn p-3 border rounded'><i class="fas fa-search me-1"></i> ${message}</p></div>`;
          document.getElementById("pagination").innerHTML = "";
          return;
        }

        const totalPages = Math.ceil(filteredBooks.length / booksPerPage);
        if (currentPage > totalPages) currentPage = totalPages || 1;
        const start = (currentPage - 1) * booksPerPage;
        const end = start + booksPerPage;
        const booksToShow = filteredBooks.slice(start, end);

        document.getElementById("viewContainer").innerHTML = "";
        const row = document.createElement("div");
        row.className = "row g-4";

        booksToShow.forEach((book, index) => {
          let bookActionHTML = "";
          let heartIconHTML = "";
          let bookStatusHTML = "";
          const encodedBookJson = encodeURIComponent(JSON.stringify(book));

          const latestUser = users.find(
            (u) => u.email === (currentUser ? currentUser.email : null)
          );
          const isCurrentlyBorrowed =
            latestUser &&
            latestUser.borrowedBooks.some((b) => b.isbn === book.isbn);
          const isFav = currentUser && latestUser.favorites.includes(book.isbn);

          const heartIconClass = isFav ? "fas fa-heart" : "far fa-heart";
          heartIconHTML = `<span class="favorite" onclick="toggleFavorite(event,'${
            book.isbn
          }')" style="color: ${isFav ? "#dc3545" : "#aaa"};">${
            heartIconClass ? `<i class="${heartIconClass}"></i>` : ""
          }</span>`;

          if (currentUser) {
            if (isCurrentlyBorrowed) {
              bookStatusHTML = `<div class="book-status status-borrowed">ƒêang M∆∞·ª£n</div>`;
              bookActionHTML = `<button class="btn btn-sm btn-borrowed w-100" disabled>ƒêang M∆∞·ª£n</button>`;
            } else {
              bookStatusHTML = `<div class="book-status status-available">S·∫µn c√≥</div>`;
              bookActionHTML = `<button class="btn btn-sm btn-success w-100" onclick='borrowBook(JSON.parse(decodeURIComponent("${encodedBookJson}")))'><i class="fas fa-exchange-alt"></i> M∆∞·ª£n S√°ch</button>`;
            }
          } else {
            bookStatusHTML = `<div class="book-status status-guest">ƒêƒÉng nh·∫≠p ƒë·ªÉ m∆∞·ª£n</div>`;
            bookActionHTML = `<button class="btn btn-sm btn-primary w-100" onclick="promptLogin()"><i class="fas fa-sign-in-alt"></i> ƒêƒÉng nh·∫≠p</button>`;
          }

          const col = document.createElement("div");
          col.className = `col-xl-4 col-lg-6 col-md-6 col-sm-6 col-12 animate__animated animate__fadeInUp`;
          col.style.setProperty("--animate-delay", `${index * 0.05}s`);

          const card = document.createElement("div");
          card.className = "card card-book h-100";
          card.innerHTML = `
            <div class="book-cover-container" onclick="${
              currentUser
                ? `openBookModal(JSON.parse(decodeURIComponent("${encodedBookJson}")))`
                : `promptLogin()`
            }">
                <img src="${book.cover}" class="book-cover"/>
            </div>
            <div class="card-body d-flex flex-column justify-content-between">
                <div class="book-info">
                    <h6 class="card-title">${book.title} ${heartIconHTML}</h6>
                    ${bookStatusHTML} 
                    <p class="mb-1 text-muted" style="font-size: 0.85rem;">T√°c gi·∫£: ${
                      book.author
                    }</p>
                    <p class="mb-2">${renderRating(book.rating)}</p>
                </div>
                ${bookActionHTML}
                <button class="btn btn-sm btn-outline-secondary w-100 mt-2" onclick="${
                  currentUser
                    ? `openBookModal(JSON.parse(decodeURIComponent("${encodedBookJson}")))`
                    : `promptLogin()`
                }"><i class="fas fa-eye me-1"></i> Xem Chi ti·∫øt</button>
            </div>
        `;
          document
            .getElementById("viewContainer")
            .appendChild(col)
            .appendChild(card);
        });

        const pagination = document.getElementById("pagination");
        pagination.innerHTML = "";

        const liPrev = document.createElement("li");
        liPrev.className = `page-item ${currentPage === 1 ? "disabled" : ""}`;
        liPrev.innerHTML = `<a class="page-link" href="#" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>`;
        liPrev.addEventListener("click", (e) => {
          e.preventDefault();
          if (currentPage > 1) {
            currentPage--;
            renderCatalog(isViewingFavorites);
            window.scrollTo({
              top: document.getElementById("catalogTitle").offsetTop - 100,
              behavior: "smooth",
            });
          }
        });
        pagination.appendChild(liPrev);
        for (let i = 1; i <= totalPages; i++) {
          const li = document.createElement("li");
          li.className = `page-item ${i === currentPage ? "active" : ""}`;
          li.innerHTML = `<a class="page-link" href="#">${i}</a>`;
          li.addEventListener("click", (e) => {
            e.preventDefault();
            currentPage = i;
            renderCatalog(isViewingFavorites);
            window.scrollTo({
              top: document.getElementById("catalogTitle").offsetTop - 100,
              behavior: "smooth",
            });
          });
          pagination.appendChild(li);
        }

        const liNext = document.createElement("li");
        liNext.className = `page-item ${
          currentPage === totalPages ? "disabled" : ""
        }`;
        liNext.innerHTML = `<a class="page-link" href="#" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>`;
        liNext.addEventListener("click", (e) => {
          e.preventDefault();
          if (currentPage < totalPages) {
            currentPage++;
            renderCatalog(isViewingFavorites);
            window.scrollTo({
              top: document.getElementById("catalogTitle").offsetTop - 100,
              behavior: "smooth",
            });
          }
        });
        pagination.appendChild(liNext);
      }

      function hidePreloader() {
        const preloader = document.getElementById("preloader");
        if (preloader) {
          preloader.style.opacity = "0";
          setTimeout(() => {
            preloader.style.display = "none";
          }, 500);
        }
      }

      initializeFilters();

      document
        .getElementById("authForm")
        .addEventListener("submit", handleAuthSubmit);
      document.getElementById("toggleAuth").addEventListener("click", () => {
        toggleAuthMode(!isLogin);
      });
      document
        .getElementById("btnLogout")
        .addEventListener("click", handleLogout);
      document.getElementById("searchInput").addEventListener("input", () => {
        currentPage = 1;
        renderCatalog(isViewingFavorites);
      });
      document
        .getElementById("categoryFilter")
        .addEventListener("change", () => {
          currentPage = 1;
          renderCatalog(isViewingFavorites);
        });
      document.getElementById("sortOption").addEventListener("change", () => {
        currentPage = 1;
        renderCatalog(isViewingFavorites);
      });
      document.getElementById("homeLink").addEventListener("click", (e) => {
        e.preventDefault();
        handleNavClick("home");
      });
      document
        .getElementById("btnContribute")
        .addEventListener("click", (e) => {
          e.preventDefault();
          handleNavClick("contributionPage");
        });
      document
        .getElementById("contributionForm")
        .addEventListener("submit", handleContributionSubmit);
      document
        .getElementById("changePasswordForm")
        .addEventListener("submit", handleChangePassword);

      updateLoginState();
      handleNavClick("home");
      setTimeout(hidePreloader, 1000);
    </script>
  </body>
</html>
